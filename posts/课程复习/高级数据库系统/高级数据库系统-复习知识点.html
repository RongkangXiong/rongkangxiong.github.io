<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>高级数据库系统-复习知识点 | 爱养虫的小熊</title><meta name="author" content="Rongkang Xiong"><meta name="copyright" content="Rongkang Xiong"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1 数据库系统概述  1.1 数据库系统基本概念 DBMS 一般架构  主要分成三条线路  1. 对于用户查询sql语句,经过**查询编译器**编译为查询计划提供给**执行引擎**,执行引擎对于索引&#x2F;文件&#x2F;记录请求交给对应**索引&#x2F;文件&#x2F;记录管理器**进行操作,而索引等底层实现即页面(page)因此通过**缓冲区管理器**(Manager Buffer)来进行读取,如果miss,则需要调用**存">
<meta property="og:type" content="article">
<meta property="og:title" content="高级数据库系统-复习知识点">
<meta property="og:url" content="https://neuralife.cn/posts/%E8%AF%BE%E7%A8%8B%E5%A4%8D%E4%B9%A0/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F-%E5%A4%8D%E4%B9%A0%E7%9F%A5%E8%AF%86%E7%82%B9">
<meta property="og:site_name" content="爱养虫的小熊">
<meta property="og:description" content="1 数据库系统概述  1.1 数据库系统基本概念 DBMS 一般架构  主要分成三条线路  1. 对于用户查询sql语句,经过**查询编译器**编译为查询计划提供给**执行引擎**,执行引擎对于索引&#x2F;文件&#x2F;记录请求交给对应**索引&#x2F;文件&#x2F;记录管理器**进行操作,而索引等底层实现即页面(page)因此通过**缓冲区管理器**(Manager Buffer)来进行读取,如果miss,则需要调用**存">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121646653.png">
<meta property="article:published_time" content="2023-02-20T12:35:28.000Z">
<meta property="article:modified_time" content="2025-01-27T21:09:27.540Z">
<meta property="article:author" content="Rongkang Xiong">
<meta property="article:tag" content="个人博客">
<meta property="article:tag" content="课程复习">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121646653.png"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/icon_duolaAmeng_1.png"><link rel="canonical" href="https://neuralife.cn/posts/%E8%AF%BE%E7%A8%8B%E5%A4%8D%E4%B9%A0/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F-%E5%A4%8D%E4%B9%A0%E7%9F%A5%E8%AF%86%E7%82%B9"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a6063fa59adbd2b2dc2df06e49673c5a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '高级数据库系统-复习知识点',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-01-28 05:09:27'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fas fa-box"></i><span> 百宝袋</span></a></div><div class="menus_item"><a class="site-page" href="/tags/MyNotes/"><i class="fa-fw fas fa-pen-nib"></i><span> 我的笔记</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时光机</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list-alt"></i><span> 我的豆瓣</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/books/"><i class="fa-fw fa fa-book"></i><span> 阅读</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fa fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/entertain/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/entertain/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/entertain/games/"><i class="fa-fw fa fa-gamepad"></i><span> 小游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fas fa-comments"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-gallery"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/guestbook/"><i class="fa-fw fa fa-book"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/friendcircle/"><i class="fa-fw fas fa-users"></i><span> 朋友圈</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121646653.png')"><nav id="nav"><span id="blog-info"><a href="/" title="爱养虫的小熊"><span class="site-name">爱养虫的小熊</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fas fa-box"></i><span> 百宝袋</span></a></div><div class="menus_item"><a class="site-page" href="/tags/MyNotes/"><i class="fa-fw fas fa-pen-nib"></i><span> 我的笔记</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时光机</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list-alt"></i><span> 我的豆瓣</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/books/"><i class="fa-fw fa fa-book"></i><span> 阅读</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fa fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/entertain/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/entertain/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/entertain/games/"><i class="fa-fw fa fa-gamepad"></i><span> 小游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fas fa-comments"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-gallery"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/guestbook/"><i class="fa-fw fa fa-book"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/friendcircle/"><i class="fa-fw fas fa-users"></i><span> 朋友圈</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">高级数据库系统-复习知识点</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-20T12:35:28.000Z" title="发表于 2023-02-20 20:35:28">2023-02-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-27T21:09:27.540Z" title="更新于 2025-01-28 05:09:27">2025-01-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AF%BE%E7%A8%8B%E5%A4%8D%E4%B9%A0/">课程复习</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AF%BE%E7%A8%8B%E5%A4%8D%E4%B9%A0/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F/">高级数据库系统</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">19.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>68分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="高级数据库系统-复习知识点"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-数据库系统概述"><a class="markdownIt-Anchor" href="#1-数据库系统概述"></a> 1 数据库系统概述</h1>
<h2 id="11-数据库系统基本概念"><a class="markdownIt-Anchor" href="#11-数据库系统基本概念"></a> 1.1 数据库系统基本概念</h2>
<p>DBMS 一般架构<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302151714788.png" alt="" /></p>
<p>主要分成三条线路</p>
<blockquote>
<pre><code>1. 对于用户查询sql语句,经过**查询编译器**编译为查询计划提供给**执行引擎**,执行引擎对于索引/文件/记录请求交给对应**索引/文件/记录管理器**进行操作,而索引等底层实现即页面(page)因此通过**缓冲区管理器**(Manager Buffer)来进行读取,如果miss,则需要调用**存储管理器**从磁盘中读取
2. 对于事务命令交由**事务管理器**进行处理,通过**生成日志和恢复**的方式保证一致性,对于生成的日志文件通过与缓冲区交互实现持久化,对于并发事务还通过**并发控制**和**锁表**保障数据一致性
3. 对于数据库管理员的DDL命令(创建/删除表等)交由DDL编译器并通过类似路线1的方式实现
</code></pre>
</blockquote>
<h3 id="111-数据"><a class="markdownIt-Anchor" href="#111-数据"></a> 1.1.1 数据</h3>
<p><strong>数据的定义</strong>：人们用来反映客观世界而记录下来的可以鉴别的符号</p>
<p><strong>数据的种类</strong>：</p>
<ul>
<li>数值数据： 0－ 9</li>
<li>非数值数据：字符、文字、声音、图形、图像等</li>
</ul>
<p><strong>数据的特点</strong>：数据与其语义是不可分的</p>
<blockquote>
<p>例子 1： 93 是一个数据<br />
语义 1：学生某门课的成绩<br />
语义 2：某人的体重<br />
语义 3：计算机学院 2016 级学生人数</p>
</blockquote>
<blockquote>
<p>例子 2：学生档案记录（李明， 197205，中国科大， 1990）<br />
语义 1：学生，出生年月，所在学校，毕业年份<br />
语义 2： 学生，出生年月，录取大学，入学时间</p>
</blockquote>
<h3 id="112-数据库"><a class="markdownIt-Anchor" href="#112-数据库"></a> 1.1.2 数据库</h3>
<p><strong>数据库的定义</strong>：数据库(Database,简称 DB)是长期储存在计算机内、 有组织的、 可共享的大量数据的集合</p>
<p><strong>数据库的基本特征</strong>：</p>
<ul>
<li>数据按一定的数据模型组织、描述和储存</li>
<li>可为各种用户共享</li>
<li>数据间联系密切，具有最小的冗余度和较高的独立性</li>
<li>服务于某个特定的应用</li>
</ul>
<blockquote>
<p>例：图书馆的图书数据库、机场的航班数据库、银行数据库……</p>
</blockquote>
<h3 id="113-数据库模式schema"><a class="markdownIt-Anchor" href="#113-数据库模式schema"></a> 1.1.3 数据库模式(Schema)</h3>
<p>数据库模式是数据库中全体数据的逻辑结构和特征的描述</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302151501620.png" alt="" /></p>
<h3 id="114-数据库管理系统"><a class="markdownIt-Anchor" href="#114-数据库管理系统"></a> 1.1.4 数据库管理系统</h3>
<p>DBMS（ Database Management System），是计算机程序的集合，用于创建和维护数据库</p>
<ul>
<li>位于操作系统和用户应用之间</li>
<li>总是基于某种数据模型</li>
<li>数据库厂商的产品通常指 DBMS，如 Oracle11g、Microsoft SQL Server 2008、 DB2、MySQL 等</li>
</ul>
<h3 id="115-数据库系统"><a class="markdownIt-Anchor" href="#115-数据库系统"></a> 1.1.5 数据库系统</h3>
<p>DBS（ DataBase System），指在计算机系统中引入了数据库后的系统，即采用了数据库技术的计算机系统</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302151503148.png" alt="" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302151504506.png" alt="" /></p>
<h3 id="116-数据库系统中的三个主要问题"><a class="markdownIt-Anchor" href="#116-数据库系统中的三个主要问题"></a> 1.1.6 数据库系统中的三个主要问题</h3>
<table>
<thead>
<tr>
<th>问题</th>
<th>内容</th>
<th>课程</th>
</tr>
</thead>
<tbody>
<tr>
<td>DBMS 实现问题</td>
<td>如何设计和实现一个 DBMS 来高效的组织和管理数据库？</td>
<td>研究生课程内容</td>
</tr>
<tr>
<td>数据库设计问题</td>
<td>如何针对特定应用的需求设计一个合理的数据库结构</td>
<td>本科课程内容</td>
</tr>
<tr>
<td>数据库存取问题</td>
<td>应用程序如何有效地存取数据库中的数据？</td>
<td>本科课程内容</td>
</tr>
</tbody>
</table>
<h2 id="12-dbms-实现问题"><a class="markdownIt-Anchor" href="#12-dbms-实现问题"></a> 1.2 DBMS 实现问题</h2>
<h3 id="121-一个虚拟的-dbmsmegatron2000"><a class="markdownIt-Anchor" href="#121-一个虚拟的-dbmsmegatron2000"></a> 1.2.1 一个虚拟的 DBMS：Megatron2000</h3>
<ul>
<li>
<p>UNIX 下的关系型 DBMS，支持 SQL</p>
</li>
<li>
<p>实现细节<br />
关系通过文件（ ASCII）存储， e.g. R 存储在<code>/usr/db/R</code>中</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Smith # 123 # CS</span><br><span class="line">Jones # 522 # EE</span><br></pre></td></tr></table></figure>
<p>数据库模式存储在特定的文件（ ASCII）中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">R1 # A # INT # B # STR …</span><br><span class="line">R2 # C # STR # A # INT …</span><br></pre></td></tr></table></figure>
<h3 id="122-megatron-2000-使用示例"><a class="markdownIt-Anchor" href="#122-megatron-2000-使用示例"></a> 1.2.2 Megatron 2000 使用示例</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&amp; select *</span><br><span class="line">  from R #</span><br><span class="line">	name id dept</span><br><span class="line">	SMITH 123 CS</span><br><span class="line">&amp;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&amp; select A,B</span><br><span class="line">  from R,S</span><br><span class="line">  where R.A = S.A and S.C &gt; 100 #</span><br><span class="line"></span><br><span class="line">	A B</span><br><span class="line">	123 CAR</span><br><span class="line">	522 CAT</span><br><span class="line">&amp;</span><br></pre></td></tr></table></figure>
<h3 id="123-megatron-2000-如何执行查询"><a class="markdownIt-Anchor" href="#123-megatron-2000-如何执行查询"></a> 1.2.3 Megatron 2000 如何执行查询？</h3>
<p>执行 “ <code>select * from R where condition</code>”:</p>
<ul>
<li>读数据字典获取 R 的属性</li>
<li>读 R 对应的文件，对于每一行数据:
<ul>
<li>检查条件</li>
<li>如果条件满足，则输出</li>
</ul>
</li>
</ul>
<p>执行”<code>select A,B from R,S where condition</code>”:</p>
<ul>
<li>读数据字典获取 R 和 S 的属性</li>
<li>读 R 文件，对于每一行数据:</li>
<li>读 S 文件，对于每一行数据:
<ul>
<li>生成连接元组</li>
<li>检查条件</li>
<li>若条件满足，则输出</li>
</ul>
</li>
</ul>
<h3 id="124-megatron-2000-存在什么问题"><a class="markdownIt-Anchor" href="#124-megatron-2000-存在什么问题"></a> 1.2.4 Megatron 2000 存在什么问题？</h3>
<h4 id="1241-元组平铺在磁盘上"><a class="markdownIt-Anchor" href="#1241-元组平铺在磁盘上"></a> 1.2.4.1 元组平铺在磁盘上</h4>
<ul>
<li>将 ’EE’改为 ’ECON’，需要重写整个文件</li>
<li>ASCII 存储过于昂贵</li>
<li>删除操作同样代价很高</li>
</ul>
<h4 id="1242-低级的查询处理"><a class="markdownIt-Anchor" href="#1242-低级的查询处理"></a> 1.2.4.2 低级的查询处理</h4>
<p>例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select *  from Student S,SC</span><br><span class="line">where S.sno = SC.sno and SC.credit &gt; 3</span><br></pre></td></tr></table></figure>
<ul>
<li>先做连接比先做选择效率要低</li>
<li>未考虑更高效的连接算法</li>
</ul>
<h4 id="1243-没有缓冲区管理"><a class="markdownIt-Anchor" href="#1243-没有缓冲区管理"></a> 1.2.4.3 没有缓冲区管理</h4>
<ul>
<li>数据直接从磁盘存取，磁盘 I/O 的代价昂贵</li>
<li>需要 Buffer 来加速数据存取效率</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302151519585.png" alt="" /></p>
<h4 id="1244-没有并发控制"><a class="markdownIt-Anchor" href="#1244-没有并发控制"></a> 1.2.4.4 没有并发控制</h4>
<ul>
<li>多用户同时存取数据时数据一致性得不到保证</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302151639149.png" alt="" /></p>
<h4 id="1245-没有索引数据查询效率低"><a class="markdownIt-Anchor" href="#1245-没有索引数据查询效率低"></a> 1.2.4.5 没有索引；数据查询效率低</h4>
<ul>
<li>不能快速地根据给定键值查询元组</li>
<li>总是要读入整个关系</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">若 page size = 8 KB， 10ms per page I/O</span><br><span class="line">1 MB (128 pages)-----1.28 s</span><br><span class="line">128 MB (16384 pages)-----163.8 s</span><br><span class="line">1 GB (131072 pages)-----1310.7 s ≈21.8 min</span><br></pre></td></tr></table></figure>
<h4 id="1246-没有可靠性"><a class="markdownIt-Anchor" href="#1246-没有可靠性"></a> 1.2.4.6 没有可靠性</h4>
<ul>
<li>发生数据库系统故障时没有恢复机制</li>
<li>易出现数据不一致的情形</li>
</ul>
<h4 id="1247-没有应用程序编程接口-api"><a class="markdownIt-Anchor" href="#1247-没有应用程序编程接口-api"></a> 1.2.4.7 没有应用程序编程接口（ API）</h4>
<ul>
<li>没有应用程序编程接口（ API）</li>
</ul>
<h4 id="1248-糟糕的数据字典组织"><a class="markdownIt-Anchor" href="#1248-糟糕的数据字典组织"></a> 1.2.4.8 糟糕的数据字典组织</h4>
<h2 id="13-数据库设计问题"><a class="markdownIt-Anchor" href="#13-数据库设计问题"></a> 1.3 数据库设计问题</h2>
<ul>
<li>
<p>如何把现实世界数据表达到数据库系统中？</p>
</li>
<li>
<p>针对一个具体应用，应该如何构造一个适合于它的数据库模式？</p>
</li>
<li>
<p>数据库模式设计不规范会带来一系列的问题</p>
<ul>
<li>数据冗余</li>
<li>更新异常</li>
<li>插入异常</li>
<li>删除异常</li>
</ul>
</li>
</ul>
<p>示例关系模式 R(Tname, Addr, C#, Cname)</p>
<ul>
<li>一个教师只有一个地址（户口所在地）</li>
<li>一个教师可教多门课程</li>
<li>一门课程只有一个任课教师</li>
<li>因此 R 的主码是（ C＃）</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302151642826.png" alt="" /></p>
<blockquote>
<ol>
<li>数据冗余：教师 T1 教了三门课程，他的地址被重复存储了 2 次</li>
<li>更新异常：如果 T1 的地址变了，则需要改变 3 个元组的地址；若有一个未更改，就会出现数据不一致。但 DBMS 无法获知这种不一致</li>
<li>插入异常：如果要增加一名教师，但他还未带课，则 C#和 Cname 为空，但由于 C＃是主码，为空违反了实体完整性，所以这名教师将无法插入到数据库中</li>
<li>删除异常：如果教师 T3 现在不带课了，则需将 T3 的元组删去，但同时也把他的姓名和地址信息以及 C6 课程信息删掉了</li>
</ol>
</blockquote>
<p>解决上述问题的办法: 模式分解:将一个大表,分解成若干相对独立的小表,通过共同主键产生关联,但是在查询时会来带额外的 join 代价</p>
<h2 id="14-方法"><a class="markdownIt-Anchor" href="#14-方法"></a> 1.4 方法</h2>
<h3 id="141-模式分解"><a class="markdownIt-Anchor" href="#141-模式分解"></a> 1.4.1 模式分解</h3>
<p>方法 1：R 分解为-&gt;授课信息丢失了</p>
<ul>
<li><code>R1(Tname,Addr)</code></li>
<li><code>R2(C#,Cname)</code></li>
</ul>
<p>方法 2： R 分解为-&gt;授课信息丢失了</p>
<ul>
<li><code>R1(Tname, Addr)</code></li>
<li><code>R2(C#,Cname)</code></li>
</ul>
<p>方法 3：R 分解为-&gt;R1 中仍然有问题</p>
<ul>
<li><code>R1(Tname, Addr, C# )</code></li>
<li><code>R2( C#, Cname)</code></li>
</ul>
<p>方法 4：-&gt;基本解决问题，但又带来 join 查询代价，可能会导致数据库性能不能满足需求</p>
<ul>
<li><code>R1( Tname, Addr)</code></li>
<li><code>R2( Tname ,C#, Cname)</code></li>
</ul>
<p><strong>数据库设计要解决的主要问题</strong>:</p>
<ul>
<li>什么样的数据库模式才合理？</li>
<li>怎么分解才能满足要求？</li>
<li>标准是什么？</li>
<li>如何实现？</li>
</ul>
<h2 id="15-数据库存取问题"><a class="markdownIt-Anchor" href="#15-数据库存取问题"></a> 1.5 数据库存取问题</h2>
<p><strong>增、删、查、改</strong></p>
<ul>
<li>用户与数据库的唯一接口——数据库语言</li>
<li>DBMS 支持用户通过数据库语言进行数据存取</li>
<li>有三类数据库语言
<ul>
<li>数据定义语言（ Data Definition Language, DDL） ——存取数据库模式</li>
<li>数据操纵语言（ Data Manipulation Language， DML） ——存取数据库数据</li>
<li>数据库控制语言（ Data Control Language，DCL） ——存取访问控制信息</li>
</ul>
</li>
</ul>
<h4 id="1501-sql-基本组成"><a class="markdownIt-Anchor" href="#1501-sql-基本组成"></a> 1.5.0.1 SQL 基本组成</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302151651536.png" alt="" /></p>
<table>
<thead>
<tr>
<th>时间</th>
<th>人物</th>
<th>贡献</th>
<th>奖项</th>
</tr>
</thead>
<tbody>
<tr>
<td>1961</td>
<td>GE 的 C.W. Bachman</td>
<td>设计了历史上第一个 DBMS——网状数据库系统 IDS (Integrated DataStore)</td>
<td>1973, 图灵奖</td>
</tr>
<tr>
<td>1968</td>
<td>IBM</td>
<td>设计了层次数据库系统 IMS</td>
<td></td>
</tr>
<tr>
<td>1969</td>
<td>CODASYL 的 DBTG</td>
<td>发表了网状数据模型报告，奠定了网状数据库技术</td>
<td></td>
</tr>
<tr>
<td>1970</td>
<td>IBM 的 E.F. Codd</td>
<td>提出了关系数据模型，奠定了关系数据库理论基础</td>
<td>1981, 图灵奖</td>
</tr>
<tr>
<td>1974</td>
<td>IBM 的 Boyce 和 Chamberlin</td>
<td>设计了 SQL 语言</td>
<td></td>
</tr>
<tr>
<td>1973~1976</td>
<td>E.F. Codd</td>
<td>设计了 System R， M. Stonebraker 设计了 Ingres</td>
<td></td>
</tr>
<tr>
<td>1976</td>
<td>IBM 的 Jim Gray</td>
<td>提出了一致性、锁粒度等设计，奠定了事务处理基础</td>
<td>1998, 图灵奖</td>
</tr>
<tr>
<td>1977</td>
<td>Larry Ellison</td>
<td>创建了 Oracle 公司,1979 年发布 Oracle 2.0，</td>
<td></td>
</tr>
<tr>
<td>1986</td>
<td>Oracle</td>
<td>上市</td>
<td></td>
</tr>
<tr>
<td>1983</td>
<td>IBM</td>
<td>发布 DB2</td>
<td></td>
</tr>
<tr>
<td>1985</td>
<td>面向对象数据库技术提出</td>
<td></td>
<td></td>
</tr>
<tr>
<td>1987</td>
<td>Sybase 1.0</td>
<td>发布</td>
<td></td>
</tr>
<tr>
<td>1990</td>
<td>M.Stonebraker</td>
<td>发表“第三代数据库系统宣言”，提出对象关系数据模型</td>
<td>2014, 图灵奖“ For fundamental contributions to the concepts and practices of underlying modern database systems”</td>
</tr>
<tr>
<td>1987 ～ 1994</td>
<td>Sybase 和 Microsoft 合作</td>
<td>发布 Sybase SQL Server 4.2。破裂后 Sybase 继续发布 Sybase ASE 11.0</td>
<td></td>
</tr>
<tr>
<td>1996</td>
<td>Microsoft</td>
<td>发布 Microsoft SQL Server 6.5</td>
<td></td>
</tr>
<tr>
<td>1996</td>
<td>开源的 MySQL 正式发布</td>
<td></td>
<td></td>
</tr>
<tr>
<td>1998</td>
<td>提出了半结构化数据模型（ XML1.0）</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2005</td>
<td>M. Stonebraker 等</td>
<td>开发完成 C-Store， Column-based DBMS</td>
<td></td>
</tr>
<tr>
<td>2007</td>
<td>NoSQL(非关系型数据库)</td>
<td>在 Web 领域大行其道。Amazon(SimpleDB/DynamoDB)、 Google(BigTable/LevelDB) 、 Facebook(Cassandra/RocksDB)、 Yahoo(PNUTS)、Yales(HadoopDB)、 Apache HBase</td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="2-关系型数据库知识"><a class="markdownIt-Anchor" href="#2-关系型数据库知识"></a> 2 关系型数据库知识</h1>
<h2 id="21-数据库体系结构"><a class="markdownIt-Anchor" href="#21-数据库体系结构"></a> 2.1 数据库体系结构</h2>
<h3 id="211-数据库模式的概念"><a class="markdownIt-Anchor" href="#211-数据库模式的概念"></a> 2.1.1 数据库模式的概念</h3>
<h4 id="2111-模式和实例"><a class="markdownIt-Anchor" href="#2111-模式和实例"></a> 2.1.1.1 模式和实例</h4>
<p>模式：Schema<br />
实例：Instance</p>
<p>模式是数据库中全体数据的逻辑结构和特征的描 述，它仅仅涉及类型的描述，不涉及具体的值<br />
模式的一个具体值称为模式的一个实例</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161408810.png" alt="" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161408134.png" alt="" /></p>
<h4 id="2112-数据库的三级模式结构"><a class="markdownIt-Anchor" href="#2112-数据库的三级模式结构"></a> 2.1.1.2 数据库的三级模式结构</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161413171.png" alt="" /></p>
<h5 id="21121-外模式"><a class="markdownIt-Anchor" href="#21121-外模式"></a> 2.1.1.2.1 外模式</h5>
<p>又称<strong>子模式、用户模式</strong></p>
<ul>
<li>单个用户所看到的局部数据的逻辑结构和特征的描述</li>
<li>用户与数据库系统的数据接口，对于用户而言，外模式就是数据库</li>
<li>建立在概念模式之上，同一模式上可有多个不同的外模式</li>
<li><strong>外部视图</strong>：外模式的实例</li>
<li>通过子模式 DDL 进行定义</li>
</ul>
<h5 id="21122-概念模式"><a class="markdownIt-Anchor" href="#21122-概念模式"></a> 2.1.1.2.2 概念模式</h5>
<p>又称<strong>模式、逻辑模式</strong></p>
<ul>
<li>数据库中全体数据的逻辑结构和特征的描述
<ul>
<li>数据记录由哪些数据项构成</li>
<li>数据项的名字、类型、取值范围</li>
<li>数据之间的联系、数据的完整性等</li>
</ul>
</li>
<li>不涉及数据物理存储的细节和硬件环境</li>
<li>一个数据库只有一个概念模式</li>
<li><strong>概念视图</strong>：概念模式的实例</li>
<li>通过模式 DDL 进行定义</li>
</ul>
<h5 id="21123-内模式"><a class="markdownIt-Anchor" href="#21123-内模式"></a> 2.1.1.2.3 内模式</h5>
<p>又称<strong>存储模式</strong></p>
<ul>
<li>数据物理结构和存储方式的描述
<ul>
<li>记录的存储方式：顺序存储、按 B 树组织还是散列存储？</li>
<li>索引按什么方式组织：排序、散列？</li>
<li>数据是否加密？是否压缩存储？</li>
</ul>
</li>
<li>不涉及物理块（或页）的大小，也不考虑具体设备的柱面或磁道大小</li>
<li>一个数据库只有一个内模式</li>
<li><strong>内部视图</strong>：内模式的实例</li>
<li>通过内模式 DDL 定义</li>
</ul>
<h4 id="2113-二级映像和数据独立性"><a class="markdownIt-Anchor" href="#2113-二级映像和数据独立性"></a> 2.1.1.3 二级映像和数据独立性</h4>
<blockquote>
<p>二级映象实现三级模式结构间的联系和转换，使用户可以逻辑地处理数据，不必关系数据的底层表示方式和存储方式</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161415194.png" alt="" /></p>
<h5 id="21131-外模式模式映象"><a class="markdownIt-Anchor" href="#21131-外模式模式映象"></a> 2.1.1.3.1 外模式/模式映象</h5>
<ul>
<li>
<p>定义了外模式与概念模式之间的对应关系</p>
<ul>
<li>属性名称可能不同</li>
<li>外模式中的属性可能由模式中的多个属性运算而得</li>
</ul>
</li>
<li>
<p>当概念模式发生改变时，只要修改外模式/模式映象，可保持外模式不变，从而保持用户应用程序不变，保证了数据与用户程序的逻辑独立性——数据的逻辑独立性</p>
</li>
</ul>
<h5 id="21132-模式内模式映象"><a class="markdownIt-Anchor" href="#21132-模式内模式映象"></a> 2.1.1.3.2 模式/内模式映象</h5>
<ul>
<li>
<p>定义了概念模式与内模式之间的对应关系</p>
<ul>
<li>概念模式中的逻辑记录和字段在内部如何表示</li>
</ul>
</li>
<li>
<p>当数据库的内部存储结构发生改变时，只要修改模式/内模式映象，可保持概念模式不<br />
变，从而保持外模式以及用户程序的不变，保证了数据与程序的物理独立性——数据的<br />
物理独立性</p>
</li>
</ul>
<h5 id="21133-举例"><a class="markdownIt-Anchor" href="#21133-举例"></a> 2.1.1.3.3 举例</h5>
<p>外模式： EMP（ EMP， DEPT， NAME）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Create View EMP(EMP,DEPT,NAME)</span><br><span class="line">As</span><br><span class="line">Select E# as EMP,D# as DEPT,name</span><br><span class="line">From Employee</span><br></pre></td></tr></table></figure>
<blockquote>
<p>E＃ -&gt; EMP#<br />
此语句定义了外模式，同时也定义了外/模映象关系</p>
</blockquote>
<ul>
<li>模式： Employee(E#,D#,Name,Salary)</li>
<li>内模式：顺序文件，索引文件， ……</li>
</ul>
<h4 id="2114-sql-数据库体系结构"><a class="markdownIt-Anchor" href="#2114-sql-数据库体系结构"></a> 2.1.1.4 SQL 数据库体系结构</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161420200.png" alt="" /></p>
<h2 id="22-关系数据模型"><a class="markdownIt-Anchor" href="#22-关系数据模型"></a> 2.2 关系数据模型</h2>
<ul>
<li>使用数据库技术，首先必须把现实世界中的事物表示为计算机能够处理的数据</li>
<li>模型是对现实世界特征的抽象</li>
<li>数据模型是对现实世界数据特征的抽象</li>
<li>数据模型的定义
<ul>
<li>描述现实世界实体、实体间联系以及数据语义和一致性约束的模型</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161422604.png" alt="" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161423271.png" alt="" /></p>
<h3 id="221-数据模型的分类"><a class="markdownIt-Anchor" href="#221-数据模型的分类"></a> 2.2.1 数据模型的分类</h3>
<ul>
<li>根据模型应用的不同目的
<ul>
<li>概念数据模型（概念模型）
<ul>
<li>按用户的观点对数据进行建模，强调语义表达功能</li>
<li>独立于计算机系统和 DBMS</li>
<li>主要用于数据库的概念设计</li>
</ul>
</li>
<li>结构数据模型（数据模型）
<ul>
<li>按计算机系统的观点对数据进行建模，直接面向数据库的逻辑结构</li>
<li>与计算机系统和 DBMS 相关（ DBMS 支持某种数据模型）</li>
<li>有严格的形式化定义，以便于在计算机系统中实现</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="23-sql"><a class="markdownIt-Anchor" href="#23-sql"></a> 2.3 SQL</h2>
<h1 id="3-数据存储"><a class="markdownIt-Anchor" href="#3-数据存储"></a> 3 数据存储</h1>
<h2 id="31-存储器结构"><a class="markdownIt-Anchor" href="#31-存储器结构"></a> 3.1 存储器结构</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161641284.png" alt="" /></p>
<p>main memory：CPU cache 级</p>
<p>RAM，代表随机访问存储器，随机意味着可以按照任何顺序访问存储单元</p>
<ul>
<li><strong>L0</strong>  寄存器</li>
<li><strong>L1</strong> L1 高速缓存，使用 SRAM（静态随机存储）</li>
<li><strong>L2</strong> L2 高速缓存</li>
<li><strong>L3</strong> L3 高速缓存</li>
<li><strong>L4</strong>  主存，使用 DRAM（动态随机存储）</li>
<li><strong>L5</strong>  本地二级存储（本地磁盘），可使用磁盘或固态硬盘 SSD（两者都是闪存，为 ROM）</li>
<li><strong>L6</strong>  远程二级存储（分布式文件系统、Web 服务器）</li>
</ul>
<p>在这个存储结构中越往上存储设备越快、越贵、越小</p>
<h3 id="311-闪存nand"><a class="markdownIt-Anchor" href="#311-闪存nand"></a> 3.1.1 闪存：NAND</h3>
<ul>
<li>写特点: 读快写慢</li>
<li>写前擦除(不支持单个数据修改)</li>
<li>按页读取(1 page = 2 KB)、按块擦除(1 block = 64 pages)</li>
<li>擦除次数有限</li>
<li>(三种型号分别支持擦除 SLC 10w 次,MLC 1W 次,TLC 1000 次)且支持按页读写以及按块擦除.</li>
</ul>
<h4 id="3111-闪存数据库面临的新挑战"><a class="markdownIt-Anchor" href="#3111-闪存数据库面临的新挑战"></a> 3.1.1.1 闪存数据库面临的新挑战</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162152301.png" alt="" /></p>
<p>代价模型查询优化<br />
索引评价标准<br />
索引结构<br />
换入换出代价<br />
空间分配<br />
损耗均衡<br />
压缩存储</p>
<p>读/写/擦除不均衡<br />
数据物理组织结构变化影响闪存寿命</p>
<h3 id="312-相变存储器pcm"><a class="markdownIt-Anchor" href="#312-相变存储器pcm"></a> 3.1.2 相变存储器：PCM</h3>
<ul>
<li>读写特点: 读取延迟较 NAND Flash 高一点(一倍左右),写入速度远快于 NAND Flash 快得多(500 倍)</li>
<li>同时本身读写并不平衡, 写快读慢 (50 倍),没有擦除延迟</li>
<li>而 NAND Flash 需要 2ms,对于擦除次数也比 NAND 高几个数量级<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162154164.png" alt="" /></li>
</ul>
<h3 id="313-磁盘"><a class="markdownIt-Anchor" href="#313-磁盘"></a> 3.1.3 磁盘</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161652315.png" alt="" /></p>
<p><strong>盘片 platter, 盘面 surface, 磁头 R/W head, 磁道 track, 柱面 cylinder, 扇区 sector</strong></p>
<p><strong>块地址</strong>：</p>
<ul>
<li>物理设备号</li>
<li>柱面号</li>
<li>盘面号（或磁头号）</li>
<li>扇区号</li>
</ul>
<h3 id="314-磁盘存取时间"><a class="markdownIt-Anchor" href="#314-磁盘存取时间"></a> 3.1.4 磁盘存取时间</h3>
<p><strong>块(Block)</strong></p>
<ul>
<li>OS 或 DBMS 进行磁盘数据存取的最小逻辑单元，由若干连续扇区构成</li>
<li>块是 DBMS 中数据存取的最小单元</li>
<li>扇区是磁盘中数据存储的最小单元</li>
</ul>
<p><strong>磁盘块读取时间</strong></p>
<ul>
<li>从“发出块存取请求”到“块位于主存”的时间</li>
<li>＝ 寻道时间 S ＋旋转延迟 R ＋传输时间 T ＋其它延迟</li>
</ul>
<p><strong>寻道时间</strong>：磁头定位到所要的柱面所花费的时间</p>
<ul>
<li>平均寻道时间：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mfrac><mrow><msubsup><mo>∑</mo><mi>i</mi><mi>N</mi></msubsup><msubsup><mo>∑</mo><mrow><mi>j</mi><mo mathvariant="normal">≠</mo><mi>i</mi></mrow><mi>N</mi></msubsup><mi>S</mi><mi>E</mi><mi>E</mi><mi>K</mi><mi>T</mi><mi>I</mi><mi>M</mi><mi>E</mi><mo stretchy="false">(</mo><mi>i</mi><mo>−</mo><mo>&gt;</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><mrow><mi>N</mi><mo stretchy="false">(</mo><mi>N</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">S=\frac{\sum_{i}^{N}\sum_{j\neq i}^{N}SEEKTIME(i-&gt;j)}{N(N-1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.795592em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.275592em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.632227em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9190928571428572em;"><span style="top:-2.1785614285714283em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.32143857142857146em;"><span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9190928571428572em;"><span style="top:-2.1785614285714283em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel mtight"></span></span><span class="fix"></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.46032428571428574em;"><span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mord mtight">−</span><span class="mrel mtight">&gt;</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><br />
S 一般在 10ms~40ms 之间</li>
</ul>
<p><strong>旋转延迟</strong>(Rotation Latency)：磁盘转动到块的第一个扇区到达磁头所需的<br />
时间</p>
<ul>
<li>平均时间为旋转 1/2 周所费的时间</li>
<li>一个 7200RPM 的磁盘平均旋转延迟 R≈4.17 ms</li>
</ul>
<p><strong>传输延迟</strong>(Transfer Time)：块的扇区及其间隙旋转通过磁头所需的时间</p>
<ul>
<li>如果磁道大约有 100 000 字节，约 10ms 转一周，则每秒可从磁盘读取约 10M 字节，一个 4K 字节的块传输时间小于 0.5ms</li>
</ul>
<p><strong>其它延迟</strong></p>
<ul>
<li>CPU 请求 I/O 的时间 (CPU time to issue I/O)</li>
<li>争用磁盘控制器时间 (Contention for controller)</li>
<li>争用总线和主存的时间 (Contention for bus, memory)</li>
</ul>
<p><strong>如何读下一块？</strong><br />
CASE 1：下一块在同一柱面上</p>
<ul>
<li>旋转延迟＋传输时间＋其它（忽略）</li>
</ul>
<p>CASE 2：不在一个柱面上</p>
<ul>
<li>寻道＋旋转＋传输＋其它</li>
</ul>
<p>For a 4KB block</p>
<ul>
<li>Random I/O ≈ 20ms</li>
<li>Sequential I/O ≈ 1 ms</li>
</ul>
<h3 id="315-写块"><a class="markdownIt-Anchor" href="#315-写块"></a> 3.1.5 写块</h3>
<p>与读块类似<br />
如果需要校验块是否正确写入，则需要加上一次旋转时间和一次块传输时间</p>
<h3 id="316-块修改"><a class="markdownIt-Anchor" href="#316-块修改"></a> 3.1.6 块修改</h3>
<ul>
<li>将块读入主存</li>
<li>在主存中完成修改</li>
<li>将块重新写入磁盘</li>
</ul>
<h3 id="317-megatron747-磁盘"><a class="markdownIt-Anchor" href="#317-megatron747-磁盘"></a> 3.1.7 Megatron747 磁盘</h3>
<p>参数 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3.5 inch</span><br><span class="line">3840 RPM</span><br><span class="line">8 surfaces</span><br><span class="line">8192 tracks/surface</span><br><span class="line">256 sectors/track</span><br><span class="line">512 bytes/sector</span><br></pre></td></tr></table></figure>
<p>Megatron 747 大小<br />
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8</mn><mo>∗</mo><mn>8192</mn><mo>∗</mo><mn>256</mn><mo>∗</mo><mn>512</mn><mo>=</mo><msup><mn>2</mn><mn>33</mn></msup><mo>=</mo><mn>8</mn><mi>G</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">8*8192*256*512 = 2^{33} = 8 GB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span><span class="mord">1</span><span class="mord">9</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord">1</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">8</span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></p>
<ul>
<li>寻道时间 (最大)： 17.4 ms</li>
<li>磁头启动停止 1 ms，每移动 500 个柱面需 1ms</li>
<li>1 block ＝ 4 KB ＝ 8 sectors</li>
<li>块之间的间隙占块的 10%大小</li>
<li>每磁道大小=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>256</mn><mi mathvariant="normal">/</mi><mn>8</mn><mo stretchy="false">)</mo><mo>∗</mo><mn>4</mn><mi>K</mi><mi>B</mi><mo>=</mo><mn>128</mn><mi>K</mi><mi>B</mi><mo>=</mo><mn>32</mn><mtext>块</mtext></mrow><annotation encoding="application/x-tex">(256/8)*4 KB=128KB=32块</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mord">/</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">2</span><span class="mord">8</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mord cjk_fallback">块</span></span></span></span></li>
<li>每柱面大小=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8</mn><mo>∗</mo><mn>128</mn><mi>K</mi><mi>B</mi><mo>=</mo><mn>1</mn><mi>M</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">8*128KB=1 MB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">2</span><span class="mord">8</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></li>
</ul>
<p>求解：</p>
<ul>
<li>
<p>3840 RPM → 1/64 秒/转 = 15.625 ms</p>
</li>
<li>
<p>读取一个磁道时间=15.625 ms, 其中</p>
<ul>
<li>用于磁道数据的时间=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>15.625</mn><mo>∗</mo><mn>0.9</mn><mo>=</mo><mn>14.0625</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">15.625 * 0.9=14.0625 ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">5</span><span class="mord">.</span><span class="mord">6</span><span class="mord">2</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">9</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">4</span><span class="mord">.</span><span class="mord">0</span><span class="mord">6</span><span class="mord">2</span><span class="mord">5</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span></span></span></span></li>
<li>用于扇区间隙的时间=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>15.625</mn><mo>∗</mo><mn>0.1</mn><mo>=</mo><mn>1.5625</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">15.625*0.1=1.5625 ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">5</span><span class="mord">.</span><span class="mord">6</span><span class="mord">2</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mord">6</span><span class="mord">2</span><span class="mord">5</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span></span></span></span></li>
</ul>
</li>
<li>
<p>读取一个块的时间=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>15.625</mn><mi mathvariant="normal">/</mi><mn>32</mn><mtext>－</mtext><mn>1.5625</mn><mi mathvariant="normal">/</mi><mn>256</mn><mo>≈</mo><mn>0.482</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">15.625/32－ 1.5625/256 ≈ 0.482 ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">5</span><span class="mord">.</span><span class="mord">6</span><span class="mord">2</span><span class="mord">5</span><span class="mord">/</span><span class="mord">3</span><span class="mord">2</span><span class="mord cjk_fallback">－</span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mord">6</span><span class="mord">2</span><span class="mord">5</span><span class="mord">/</span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">8</span><span class="mord">2</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span></span></span></span></p>
</li>
<li>
<p>读取数据的时间=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>15.625</mn><mi mathvariant="normal">/</mi><mn>32</mn><mo>∗</mo><mn>0.9</mn><mo>≈</mo><mn>0.439</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">15.625/32 * 0.9 ≈ 0.439 ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">5</span><span class="mord">.</span><span class="mord">6</span><span class="mord">2</span><span class="mord">5</span><span class="mord">/</span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">9</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">3</span><span class="mord">9</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span></span></span></span></p>
</li>
<li>
<p>OS 或 DBMS 随机读取一块的最大时间</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>=</mo><mi>S</mi><mtext>＋</mtext><mi>R</mi><mtext>＋</mtext><mi>T</mi><mo>=</mo><mn>17.4</mn><mo>+</mo><mn>15.625</mn><mo>+</mo><mn>0.482</mn><mo>≈</mo><mn>33.507</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">T=S＋ R＋ T=17.4 + 15.625 + 0.482 ≈ 33. 507 ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord cjk_fallback">＋</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord cjk_fallback">＋</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">7</span><span class="mord">.</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">5</span><span class="mord">.</span><span class="mord">6</span><span class="mord">2</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">8</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">3</span><span class="mord">.</span><span class="mord">5</span><span class="mord">0</span><span class="mord">7</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span></span></span></span></li>
</ul>
</li>
<li>
<p>最小时间： 0.482 ms</p>
</li>
<li>
<p>平均寻道数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>＝</mtext><mn>8192</mn><mi mathvariant="normal">/</mi><mn>3</mn><mtext>＝</mtext><mn>2730</mn><mo separator="true">,</mo><mn>1</mn><mo>+</mo><mn>2730</mn><mi mathvariant="normal">/</mi><mn>500</mn><mo>=</mo><mn>6.5</mn></mrow><annotation encoding="application/x-tex">＝8192/3＝2730,1+2730/500 =6.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">＝</span><span class="mord">8</span><span class="mord">1</span><span class="mord">9</span><span class="mord">2</span><span class="mord">/</span><span class="mord">3</span><span class="mord cjk_fallback">＝</span><span class="mord">2</span><span class="mord">7</span><span class="mord">3</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord">7</span><span class="mord">3</span><span class="mord">0</span><span class="mord">/</span><span class="mord">5</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">6</span><span class="mord">.</span><span class="mord">5</span></span></span></span></p>
</li>
<li>
<p>平均时间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>=</mo><mi>S</mi><mtext>＋</mtext><mi>R</mi><mtext>＋</mtext><mi>T</mi><mo>=</mo><mn>6.5</mn><mo>+</mo><mn>7.8125</mn><mo>+</mo><mn>0.482</mn><mo>≈</mo><mn>14.8</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">T=S＋ R＋ T =6.5 + 7.8125 + 0.482 ≈ 14.8 ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord cjk_fallback">＋</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord cjk_fallback">＋</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">6</span><span class="mord">.</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">7</span><span class="mord">.</span><span class="mord">8</span><span class="mord">1</span><span class="mord">2</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">8</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">4</span><span class="mord">.</span><span class="mord">8</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span></span></span></span></p>
</li>
</ul>
<h3 id="318-磁盘存取优化"><a class="markdownIt-Anchor" href="#318-磁盘存取优化"></a> 3.1.8 磁盘存取优化</h3>
<ul>
<li>按柱面组织数据
<ul>
<li>减少平均寻道时间</li>
</ul>
</li>
<li>磁盘调度算法
<ul>
<li>如电梯算法 (Elevator Algorithm)</li>
</ul>
</li>
<li>磁盘阵列(Disk Arrays)</li>
<li>磁盘镜像(Disk Mirrors)</li>
<li>Random IO to Sequential IO</li>
<li>预取(Pre-fetch)和缓冲(Buffering)</li>
</ul>
<h4 id="3181-random-io-to-sequential-io"><a class="markdownIt-Anchor" href="#3181-random-io-to-sequential-io"></a> 3.1.8.1 Random IO to Sequential IO</h4>
<p>Page requests: 1－91－2－92－3－93－4－94……<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161712539.png" alt="" /></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">94 93 92 91</span><br><span class="line">4  3  2  1</span><br></pre></td></tr></table></figure>
<p>优化前：8 次随机 IO ~160ms<br />
优化后：2 次随机 IO+6 次顺序 IO ~46ms</p>
<h4 id="3182-预取缓冲"><a class="markdownIt-Anchor" href="#3182-预取缓冲"></a> 3.1.8.2 预取/缓冲</h4>
<ul>
<li>单缓冲(Single Buffering)<br />
(1) 将 B1 读入缓冲区<br />
(2) 在缓冲区中处理 B1 中的数据<br />
(3) 将 B2 读入缓冲区<br />
(4) 处理缓冲区中的 B2 数据</li>
</ul>
<p>设</p>
<ul>
<li>
<p>P = 在缓冲区中处理一块的时间</p>
</li>
<li>
<p>R = 将一块读入缓冲区的时间</p>
</li>
<li>
<p>n = 块数<br />
<strong>单缓冲处理时间 = n(P+R)</strong></p>
</li>
<li>
<p>双缓冲(Double Buffering) ：处理的时候预读<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161731964.png" alt="" /><br />
设</p>
</li>
<li>
<p>P = 在缓冲区中处理一块的时间</p>
</li>
<li>
<p>R = 将一块读入缓冲区的时间</p>
</li>
<li>
<p>n = 块数<br />
<strong>双缓冲处理时间</strong>＝ R ＋ nP（ P&gt;=R）<br />
＝ nR ＋ P（ R&gt;=P）</p>
</li>
</ul>
<p>缓冲的代价：</p>
<ul>
<li>主存代价</li>
<li>缓冲区管理</li>
<li>一致性维护</li>
</ul>
<h4 id="3183-块大小选择"><a class="markdownIt-Anchor" href="#3183-块大小选择"></a> 3.1.8.3 块大小选择</h4>
<p>块大小与应用数据特性密切相关</p>
<table>
<thead>
<tr>
<th>大块</th>
<th>小块</th>
</tr>
</thead>
<tbody>
<tr>
<td>IO 次数小</td>
<td>IO 次数大</td>
</tr>
<tr>
<td>可能读入大量无用数据</td>
<td></td>
</tr>
<tr>
<td>每次 IO 花费时间更多</td>
<td></td>
</tr>
<tr>
<td>简单查询的读写放大严重</td>
<td></td>
</tr>
<tr>
<td>索引小，B+树索引层次少，查询高效</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="319-新型存储"><a class="markdownIt-Anchor" href="#319-新型存储"></a> 3.1.9 新型存储</h3>
<p>新型存储器件包括： 闪存、相变存储器、磁阻式存储、电阻式存储器 、忆阻器等等。</p>
<p>具备一个共同特点： 非易失性</p>
<p>优点：高存储密度、低功耗、无机械延迟、存取速度快、便携、抗震、低<br />
噪音等</p>
<p>缺点：读写性能不对称、读写次数有限、可靠性不高等</p>
<h4 id="3191-新型存储计算架构"><a class="markdownIt-Anchor" href="#3191-新型存储计算架构"></a> 3.1.9.1 新型存储计算架构</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162155808.png" alt="" /></p>
<h2 id="32-数据表示"><a class="markdownIt-Anchor" href="#32-数据表示"></a> 3.2 数据表示</h2>
<h3 id="321-数据元素的表示层次"><a class="markdownIt-Anchor" href="#321-数据元素的表示层次"></a> 3.2.1 数据元素的表示层次</h3>
<table>
<thead>
<tr>
<th>数据项</th>
<th>属性值的物理组织</th>
</tr>
</thead>
<tbody>
<tr>
<td>记录</td>
<td>元组的物理组织</td>
</tr>
<tr>
<td>块</td>
<td>记录的物理存放</td>
</tr>
<tr>
<td>文件</td>
<td>文件由磁盘块构成</td>
</tr>
</tbody>
</table>
<h3 id="322-数据项表示内容"><a class="markdownIt-Anchor" href="#322-数据项表示内容"></a> 3.2.2 数据项表示内容</h3>
<p><strong>表示的内容</strong>：</p>
<ul>
<li>姓名</li>
<li>年龄</li>
<li>出生日期</li>
<li>照片</li>
</ul>
<p><strong>表示方法</strong>：</p>
<ul>
<li>Bytes</li>
</ul>
<h3 id="323-数据项表示方法sql-数据类型"><a class="markdownIt-Anchor" href="#323-数据项表示方法sql-数据类型"></a> 3.2.3 数据项表示方法：SQL 数据类型</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162215824.png" alt="" /></p>
<ul>
<li>
<p>Integer（short）</p>
<ul>
<li>2 bytes</li>
<li>例如 35 表示为 <code>00000000 00100011</code></li>
</ul>
</li>
<li>
<p>Real, Float</p>
<ul>
<li>4 bytes(32 bits)</li>
<li>N bits 表示小数，M bits 表示指数</li>
</ul>
</li>
<li>
<p>Char(n)或 Character(n)定长字符串</p>
<ul>
<li>小于 n 时使用特殊填充符</li>
<li>例如，若属性类型为 Char(5)，则属性值’cat’ 表示为<code>cat⊥⊥</code></li>
</ul>
</li>
<li>
<p>Varchar(n) 变长字符串</p>
<ul>
<li>NULL 终止符，例 Varchar(5), <code>cat\0</code></li>
<li>带长度, <code>3cat\0</code></li>
<li>定长表示， n+1 bytes</li>
<li>Varchar(4)：`cat⊥⊥</li>
</ul>
</li>
</ul>
<blockquote>
<p>不可见字符通常用反斜杠<code>\</code>+其 ASCII 码值表示，NULL 常用<code>\0</code>表示，另外，在 C 语言的头文件 stdio.h 中，NULL 被宏定义为 0</p>
</blockquote>
<ul>
<li>
<p>Boolean</p>
<ul>
<li>TRUE：<code>1111 1111</code></li>
<li>FALSE：<code>0000 0000</code></li>
</ul>
</li>
<li>
<p>枚举类型</p>
<ul>
<li><code>&#123;RED,GREEN,YELLOW&#125;</code></li>
<li>整数表示
<ul>
<li><code>RED&lt;-&gt;1</code>,<code>GREEN&lt;-&gt;2</code>,<code>YELLOW&lt;-&gt;3</code></li>
<li>若用两个字节的短整型来表示，则可以表示<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>1</mn></msup><mn>6</mn><mo>=</mo><mn>65536</mn></mrow><annotation encoding="application/x-tex">2^16=65536</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mord">6</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">6</span><span class="mord">5</span><span class="mord">5</span><span class="mord">3</span><span class="mord">6</span></span></span></span>个不同的值</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Date</p>
<ul>
<li>10 字符(SQL92)：<code>YYYY-MM-DD</code>字符串表示</li>
<li>8 字符： <code>YYYYMMDD</code></li>
<li>7 字符： <code>YYYYDDD</code>, NOT ‘YYMMDD’!</li>
<li>Integer，自 1900-01-01 以来的天数</li>
</ul>
</li>
<li>
<p>Time</p>
<ul>
<li>8 字符(SQL92)： <code>HH:NN:SS</code>——整数秒</li>
<li>Varchar(n)： <code>HH:NN:SS.FF</code>——带小数秒</li>
<li>Integer，自 00:00:00 以来的秒数</li>
</ul>
</li>
<li>
<p>Bit</p>
<ul>
<li>带长度的二进制位串：<code>Length|Bits</code></li>
<li>按直接表示，例如<code>010111110011</code></li>
<li><code>01011111 00110000</code></li>
</ul>
</li>
</ul>
<p>定长数据项<br />
变长数据项：</p>
<ul>
<li>带长度（常用）</li>
<li>Null Terminated</li>
</ul>
<h2 id="33-记录的组织"><a class="markdownIt-Anchor" href="#33-记录的组织"></a> 3.3 记录的组织</h2>
<p>记录：</p>
<ul>
<li>数据项 <code>[字段,Fields]</code> 的集合</li>
<li>E.g.:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Employee record:</span><br><span class="line">	name field,</span><br><span class="line">	salary field,</span><br><span class="line">	date-of-hire field, ...</span><br></pre></td></tr></table></figure>
<h3 id="331-固定格式定长记录"><a class="markdownIt-Anchor" href="#331-固定格式定长记录"></a> 3.3.1 固定格式定长记录</h3>
<ul>
<li>所有记录具有相同的逻辑结构（模式）</li>
<li>记录的模式（ Schema）
<ul>
<li>fields</li>
<li>Name of each field</li>
<li>Type of each field</li>
<li>Order in record</li>
<li>Offset of each field in the record</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162219745.png" alt="" /></p>
<p>构造：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> MovieStar(</span><br><span class="line">	name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">	address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">	gender <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">	birthdate <span class="type">DATE</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>不考虑寻址特点：<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162222402.png" alt="" /></p>
<p>考虑寻址特点：</p>
<ul>
<li><strong>假设记录和字段的开始地址必须按 4 的倍数对齐</strong><br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162223509.png" alt="" /></li>
</ul>
<p><strong>记录首部(Head)</strong>：描述记录的信息</p>
<ul>
<li>记录类型（模式信息）</li>
<li>记录长度</li>
<li>时间戳</li>
<li>其它信息<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162224535.png" alt="" /></li>
</ul>
<h3 id="332-可变格式记录"><a class="markdownIt-Anchor" href="#332-可变格式记录"></a> 3.3.2 可变格式记录</h3>
<ul>
<li>
<p>每个记录的格式不同</p>
</li>
<li>
<p>记录的格式储存于记录中<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162225083.png" alt="" /></p>
</li>
<li>
<p>Key-Value</p>
</li>
<li>
<p>记录都以<code>KEY+VALUE</code>方式表示</p>
</li>
<li>
<p>KEY 与 VALUE 都以字节流（ byte string）存储，<br />
如下</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="type">void</span> *data; <span class="comment">//字节流指针</span></span><br><span class="line">	<span class="type">int</span> size; <span class="comment">//字节流长度</span></span><br><span class="line">&#125; DBT;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>BerkeleyDB</li>
<li>Memcached</li>
<li>Redis</li>
<li>LevelDB</li>
<li>RocksDB</li>
</ul>
</blockquote>
<ul>
<li>数据类型没有限制</li>
<li>应用与数据库之间不需转换数据格式</li>
<li>不提供 KEY 和 VALUE 的内容和结构信息</li>
<li>应用必须知道所用的 VALUE 的含义</li>
<li>好处</li>
<li>灵活的记录格式，适合“松散”记录
<ul>
<li>尽管一个记录可能有大量字段，但某个记录通常只有有限的几个字段</li>
<li>例如，病人的检验结果</li>
</ul>
</li>
<li>适合处理重复字段</li>
<li>适合记录格式演变</li>
</ul>
<p>缺点</p>
<ul>
<li>标记存储方式空间代价高， KV 方式难以支持复杂</li>
<li>查询、应用负担重而且事务处理等实现困难</li>
</ul>
<h3 id="333-变长记录表示"><a class="markdownIt-Anchor" href="#333-变长记录表示"></a> 3.3.3 变长记录表示</h3>
<ul>
<li>
<p>首部指针法 - 定长字段在前，变长字段在后 - name、 address 变长<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162229036.png" alt="" /></p>
</li>
<li>
<p>混合格式：定长记录+变长记录<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162230504.png" alt="" /></p>
</li>
</ul>
<h2 id="34-记录在块中的组织"><a class="markdownIt-Anchor" href="#34-记录在块中的组织"></a> 3.4 记录在块中的组织</h2>
<p>假设：</p>
<ul>
<li>块的大小固定</li>
<li>记录组织成单个文件<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162231899.png" alt="" /></li>
</ul>
<h3 id="341-定长记录的两种块内组织"><a class="markdownIt-Anchor" href="#341-定长记录的两种块内组织"></a> 3.4.1 定长记录的两种块内组织</h3>
<ul>
<li>记录地址 rid 通常使用<code>&lt;块号，槽号&gt;</code>表示<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162232190.png" alt="" /></li>
</ul>
<h3 id="342-变长记录在块内的组织"><a class="markdownIt-Anchor" href="#342-变长记录在块内的组织"></a> 3.4.2 变长记录在块内的组织</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162232939.png" alt="" /></p>
<h3 id="343-其他问题"><a class="markdownIt-Anchor" href="#343-其他问题"></a> 3.4.3 其他问题</h3>
<h4 id="3431-记录在块中的分隔-separating-records"><a class="markdownIt-Anchor" href="#3431-记录在块中的分隔-separating-records"></a> 3.4.3.1 记录在块中的分隔 (separating records)</h4>
<p>定长记录：不需分隔<br />
不定长记录：</p>
<ul>
<li>使用特殊标记</li>
<li>通过块内偏移量<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162248366.png" alt="" /></li>
</ul>
<h4 id="3432-记录跨块-vs记录不跨块"><a class="markdownIt-Anchor" href="#3432-记录跨块-vs记录不跨块"></a> 3.4.3.2 记录跨块 vs.记录不跨块</h4>
<p>(spanned vs. unspanned)<br />
spanned：记录可跨块存储</p>
<ul>
<li>有效利用空间，实现更复杂<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162301381.png" alt="" /></li>
</ul>
<p>unspanned：记录必须在一个块中存储</p>
<ul>
<li>实现简单，但空间浪费<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302162301816.png" alt="" /></li>
</ul>
<p>If record size &gt; block size， MUST be spanned</p>
<h4 id="3433-不同类型的记录聚簇"><a class="markdownIt-Anchor" href="#3433-不同类型的记录聚簇"></a> 3.4.3.3 不同类型的记录聚簇</h4>
<p>(mixed record types – clustering)</p>
<p>一个块中存储不同类型的记录<br />
（对于 RDB： 多关系上的聚簇</p>
<h4 id="3434-按序组织-sequencing"><a class="markdownIt-Anchor" href="#3434-按序组织-sequencing"></a> 3.4.3.4 按序组织 (sequencing)</h4>
<h4 id="3435-记录的分裂-split-records"><a class="markdownIt-Anchor" href="#3435-记录的分裂-split-records"></a> 3.4.3.5 记录的分裂 (split records)</h4>
<h4 id="3436-记录地址-record-address"><a class="markdownIt-Anchor" href="#3436-记录地址-record-address"></a> 3.4.3.6 记录地址 (record address)</h4>
<h4 id="3437-记录的修改"><a class="markdownIt-Anchor" href="#3437-记录的修改"></a> 3.4.3.7 记录的修改</h4>
<h1 id="4-数据表示"><a class="markdownIt-Anchor" href="#4-数据表示"></a> 4 数据表示</h1>
<h1 id="5-缓冲区管理"><a class="markdownIt-Anchor" href="#5-缓冲区管理"></a> 5 缓冲区管理</h1>
<h2 id="51-基本概念"><a class="markdownIt-Anchor" href="#51-基本概念"></a> 5.1 基本概念</h2>
<p>缓冲区的底层物理层结构：<strong>内存</strong><br />
缓冲区大小衡量的基本单位：<strong>页(page)</strong></p>
<blockquote>
<p>原因在于磁盘与内存 IO 之间最小的单位也是 page</p>
</blockquote>
<p>通常意义下的 page 一般指磁盘 page，对于内存页通常使用 frame 来代表<br />
中文的内存 page 为“缓存页”</p>
<table>
<thead>
<tr>
<th></th>
<th>一个 frame 对应一个页</th>
<th>一个 frame 对应多个页</th>
</tr>
</thead>
<tbody>
<tr>
<td>缺点</td>
<td>缓存置换算法运行 CPU 代价大(因为一次处理一个页)</td>
<td>缓存空间利用率下降,命中率下降</td>
</tr>
<tr>
<td>优点</td>
<td>缓存 100%利用率,使得命中率提升</td>
<td>cpu 代价下降(一次可以处理多个页)</td>
</tr>
</tbody>
</table>
<blockquote>
<p>举例:<br />
使用一个 frame 对应 4 个 page,那么假设一开始内存满了,但是需要读取新的元素,那么从内存中移除 4 个物理 page,然后再加入 1 个物理 page,那么这时出现了 3 个物理页没有装载,因此导致空间利用率下降,同时由于利用率下降那么命中率就下降了. 由于通常情况下 cpu 计算时间远小于未命中时 IO 代价,因此目前系统中通常使用 1 个 frame 对应 1 个 page 的方式来实现. 但是对于某些计算资源为瓶颈的情况,则可能会使用一个 frame 对应多个页</p>
</blockquote>
<p><strong>为什么不使用 OS 缓冲区管理？</strong></p>
<ul>
<li>DBMS 经常能预测访问模式(Access Pattern)
<ul>
<li>可以使用更专门的缓冲区替换策略</li>
<li>有利于 pre-fetch 策略的有效使用</li>
</ul>
</li>
<li>DBMS 需要强制写回磁盘能力（如 WAL） ， OS 的缓冲写回一般通过记录写请求来实 现（来自不同应用），实际的磁盘修改推迟，因此不能保证写顺序</li>
</ul>
<h2 id="52-缓冲区结构"><a class="markdownIt-Anchor" href="#52-缓冲区结构"></a> 5.2 缓冲区结构</h2>
<h3 id="521-frame-的参数"><a class="markdownIt-Anchor" href="#521-frame-的参数"></a> 5.2.1 frame 的参数</h3>
<p><strong>Dirty</strong>：标记 Frame 中的块是否改写,数据写回时使用该标志来判断是否需要对磁盘数据进行赋写</p>
<p><strong>Pin-count</strong>：</p>
<blockquote>
<p>Frame 的块被请求但是还未释放的计数,即当前使用该 frame 的用户数,该标志位主要用于多进程读(不是读写,因为读写会冲突),当计数大于等于 0 的 frame 不能被改写或释放.<br />
PS:该标识位主要用于非抢占的架构,即各进程(用户)平权,如果可以抢占则对于某些优先级高的请求则可以无视 Pin-count 标志强制进行改写<br />
Frame 的块的已经被请求并且还未被释放的计数，即当前的用户数</p>
</blockquote>
<p><strong>Others</strong>：</p>
<ul>
<li><strong>Latch</strong>：是否加锁，会影响性能，但是保证数据一致性</li>
</ul>
<h2 id="53-缓冲区替换策略"><a class="markdownIt-Anchor" href="#53-缓冲区替换策略"></a> 5.3 缓冲区替换策略</h2>
<p><strong>OPT</strong>：理论最优算法</p>
<ul>
<li>也称为 Belady’s 算法</li>
<li>理论上最佳的页面置换算法，它每次都置换以后永远也用不到的页面，如果没有则淘汰最久以后再用到的页面</li>
<li>OPT 算法必须预先知道全部的页面访问序列，而这在实际 DBMS/OS 中是无法实现的，因此仅有理论意义</li>
<li>但是 OPT 算法可以在实验中作为算法性能上界加以对比<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161533403.png" alt="" /></li>
</ul>
<p><strong>LRU</strong>：Least-recently-used</p>
<ul>
<li>Oracle、Sybase、Informix 都使用这个</li>
<li>所有 frame 按照最近一次访问时间排列成一个链表</li>
<li>基于<strong>时间局部性</strong>(Temporal Locality) 假设： 越是最近访问的在未来被访问的概率越高. 总是替换 LRU 端的 frame</li>
<li>适用于重复访问热门页面</li>
<li>幸存选择 O(1)复杂度</li>
</ul>
<p>缺点：</p>
<ul>
<li>缓存污染：LRU ＋重复顺序扫描</li>
<li>每次访问都需要修改 LRU 表</li>
<li>如果访问不满足时间局部性，则性能较差</li>
<li>只考虑最近一次访问，不考虑访问频率</li>
</ul>
<p><strong>LRU-k</strong>：如果某个 frame 的访问次数达到了 K 次以上，则应当尽量不置换<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161630634.png" alt="" /></p>
<ul>
<li>维护 2 个 LRU 链表
<ul>
<li>一个是访问次数小于 k 次的</li>
<li>一个是访问个次数 k 次以上的</li>
</ul>
</li>
<li>优先按照 LRU 策略置换小于 K 次的链表</li>
<li>保证高频访问的页能够尽量在 buffer 中</li>
<li>实验表明 K 并非越大越好， <strong>LRU-2 性能较好</strong></li>
</ul>
<p>缺点</p>
<ul>
<li>需要额外记录访问次数</li>
</ul>
<p><strong>2Q</strong>：与 LRU-2 类似，不同之处在于访问 1 次的队列采用 FIFO，而不是 LRU<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161630566.png" alt="" /></p>
<p><strong>Second-Change FIFO</strong>：所有 frame 组成 FIFO 链表，每个 frame 附加一个 bit 位，初始为 0。当 FO 页第一次被选中置换时置为 1，并移到 FI 端。只有 bit 位为 1 的 FO 端的页才被选中置换<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161632372.png" alt="" /></p>
<ul>
<li>相当于每个 frame 给了两次置换机会，避免高频访问但最近一轮没有被访问的 frame 被置换出 buffer</li>
<li>每个 frame 只需要 1 个额外 bit，空间代价很低<br />
缺点：</li>
<li>置换时需要移动多个元素，理论性能比 LRU 差</li>
</ul>
<p><strong>Clock</strong>：把 Second-Chance FIFO 组织成环形<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161633165.png" alt="" /></p>
<ul>
<li>N 个 frame 组成环形,current 指针指向当前 frame;每个 frame 有一个 referenced 位,初始为 1；</li>
<li>当需要置换页时，从 current 开始检查，若 pin-count&gt;0， current 增加 1；若 referenced<br />
已启动（ =1），则关闭它（ =0）并增加 current（保证最近的不被替换）；若 pin-count=0 并且 referenced 关闭（ =0），则替换该 frame，同时 current 加 1</li>
<li>注意： Current 指针只在置换时更新，访问命中时不改变 Current 指针</li>
</ul>
<p><strong>SSD-aware</strong>：读快写慢，写次数有限</p>
<ul>
<li>
<p>CFLRU (CASES’06， CASES’21 Test of Time Award)</p>
<ul>
<li>Clean-first<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161635543.png" alt="" /></li>
</ul>
</li>
<li>
<p>LRU-WSR (IEEE Trans CE’08)</p>
<ul>
<li>Clean-first + cold flag</li>
<li>置换： clean&gt;cold dirty&gt;hot dirty</li>
</ul>
</li>
<li>
<p>AD-LRU (DKE’10)</p>
<ul>
<li>cold LRU list + hot LRU list</li>
<li>Dynamically adjust two LRUs</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302161635507.png" alt="" /></p>
<p><strong>FIFO</strong>：</p>
<p><strong>MRU</strong>：</p>
<h2 id="54-缓冲区管理器的实现"><a class="markdownIt-Anchor" href="#54-缓冲区管理器的实现"></a> 5.4 缓冲区管理器的实现</h2>
<h1 id="6-索引结构"><a class="markdownIt-Anchor" href="#6-索引结构"></a> 6 索引结构</h1>
<h2 id="61-基本概念"><a class="markdownIt-Anchor" href="#61-基本概念"></a> 6.1 基本概念</h2>
<h2 id="62-顺序文件上的索引"><a class="markdownIt-Anchor" href="#62-顺序文件上的索引"></a> 6.2 顺序文件上的索引</h2>
<p>顺序文件：记录按查找键排序<br />
Search-key: 10,20,30,40,…</p>
<h3 id="621-密集索引"><a class="markdownIt-Anchor" href="#621-密集索引"></a> 6.2.1 密集索引</h3>
<ul>
<li>每个记录都有一个索引项</li>
<li>索引项按查找键排序<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191633649.png" alt="" /><br />
查找：查找索引项，跟踪指针即可</li>
</ul>
<p>密集索引的优点：</p>
<ul>
<li>记录通常比索引项要大</li>
<li>索引可以常驻内存</li>
<li>要查找键值为 K 的记录是否存在，不需要访问磁盘数据块</li>
</ul>
<p>密集索引的缺点：</p>
<ul>
<li>索引占用太多空间-&gt;用稀疏索引改进</li>
</ul>
<h3 id="622-稀疏索引sparse-index"><a class="markdownIt-Anchor" href="#622-稀疏索引sparse-index"></a> 6.2.2 稀疏索引(Sparse Index)</h3>
<ul>
<li>仅部分记录有索引项</li>
<li>一般情况：为每个数据块的第一个记录建立索引<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191635164.png" alt="" /></li>
</ul>
<p>稀疏索引的优点：</p>
<ul>
<li>节省了索引空间</li>
<li>对同样的记录，稀疏索引可以使用更少的索引项</li>
</ul>
<p>稀疏索引的缺点：</p>
<ul>
<li>对于“是否存在键值为 K 的记录？”，需要访问磁盘数据块</li>
</ul>
<h3 id="623-多级索引"><a class="markdownIt-Anchor" href="#623-多级索引"></a> 6.2.3 多级索引</h3>
<p>索引上再建索引：二级索引、三级索引<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191636715.png" alt="" /></p>
<p>多级索引的优点：</p>
<ul>
<li>一级索引可能还太大而不能常驻内存</li>
<li>二级索引更小，可以常驻内存</li>
<li>减少磁盘 I/O 次数</li>
<li>当一级索引过大而二级索引可常驻内存时有效</li>
<li>二级索引仅可用稀疏索引</li>
</ul>
<p>思考：二级密集索引有用吗？</p>
<blockquote>
<p>密集索引对于二级索引可以有所帮助，但它们不能提供太多优势。密集索引可以降低索引项在磁盘中的碎片，使得索引项更容易被加载到内存中。但是，它并不能提供太多的查询性能的改善，因为二级索引的查询操作不是非常频繁的，而且数据量也不会太大。</p>
</blockquote>
<blockquote>
<p>例：一块＝ 4KB。一级索引 10,000 个块，每个块可存 100 个索引项，共 40MB。二级稀疏索引 100 个块，共 400KB。</p>
</blockquote>
<p>按一级索引查找(二分查找)：平均 lg10000≈13 次 I/O 定位索引块，加一次数据块 I/O，共约 14 次 I/O<br />
按二级索引查找：定位二级索引块 0 次 I/O，读入一级索引块 1 次 I/O，读入数据块 1 次 I/O，共 2 次 I/O</p>
<p>一般不考虑三级以上索引</p>
<ul>
<li>维护多级索引结构</li>
<li>有更好的索引结构——B ＋ 树</li>
</ul>
<h2 id="63-辅助索引"><a class="markdownIt-Anchor" href="#63-辅助索引"></a> 6.3 辅助索引</h2>
<p>主索引(Primary Index)</p>
<ul>
<li>顺序文件上的索引</li>
<li>记录按索引属性值有序</li>
<li>根据索引值可以确定记录的位置</li>
</ul>
<p>辅助索引（Secondary Index）</p>
<ul>
<li>数据文件不需要按查找键有序</li>
<li>根据索引值不能确定记录在文件中的顺序</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">MovieStar</span>(name <span class="built_in">char</span>(<span class="number">10</span>) PRIMARY KEY, address <span class="built_in">char</span>(<span class="number">20</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>Name 上创建了主索引，记录按 name 有序</li>
<li>Address 上创建辅助索引</li>
<li>辅助索引只能是密集索引</li>
</ul>
<blockquote>
<p>稀疏的辅助索引有意义吗？</p>
</blockquote>
<h2 id="64-倒排索引inverted-index"><a class="markdownIt-Anchor" href="#64-倒排索引inverted-index"></a> 6.4 倒排索引(Inverted Index)</h2>
<p>应用于文档检索，与辅助索引思想类似<br />
不同之处</p>
<ul>
<li>记录-&gt;文档</li>
<li>记录查找-&gt;文档检索</li>
<li>查找键-&gt;文档中的词</li>
</ul>
<p>思想</p>
<ul>
<li>为每个检索词建立间接桶</li>
<li>桶的指针指向检索词所出现的文档<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191704413.png" alt="" /><br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191705935.png" alt="" /></li>
</ul>
<h2 id="65-b树"><a class="markdownIt-Anchor" href="#65-b树"></a> 6.5 B+树</h2>
<ul>
<li>一种树型的多级索引结构</li>
<li>树的层数与数据大小相关，通常为 3 层</li>
<li>所有结点格式相同： n 个值， n ＋ 1 个指针</li>
<li>所有叶结点位于同一层</li>
</ul>
<h3 id="651-叶节点"><a class="markdownIt-Anchor" href="#651-叶节点"></a> 6.5.1 叶节点</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191706475.png" alt="" /></p>
<ul>
<li>至少<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⌊</mo><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">\lfloor (n+1)/2 \rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">⌊</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">2</span><span class="mclose">⌋</span></span></span></span> 个指针指向键值</li>
<li>1 个指向相邻叶结点的指针</li>
<li>n 对键－指针对</li>
</ul>
<h3 id="652-中间节点"><a class="markdownIt-Anchor" href="#652-中间节点"></a> 6.5.2 中间节点</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191707649.png" alt="" /></p>
<ul>
<li>n 个键值划分 n+1 个子树</li>
<li>第 i 个键值是第 i+1 个子树中的最小键值</li>
<li>至少 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⌈</mo><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn><mo stretchy="false">⌉</mo></mrow><annotation encoding="application/x-tex">\lceil (n+1)/2 \rceil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">⌈</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">2</span><span class="mclose">⌉</span></span></span></span> 个指针指向子树</li>
<li>根结点至少 2 个指针</li>
</ul>
<h3 id="653-b树查找"><a class="markdownIt-Anchor" href="#653-b树查找"></a> 6.5.3 B+树查找</h3>
<ul>
<li>从根结点开始</li>
<li>沿指针向下，直到到达叶结点</li>
<li>在叶结点中顺序查找</li>
</ul>
<h3 id="654-b树插入"><a class="markdownIt-Anchor" href="#654-b树插入"></a> 6.5.4 B+树插入</h3>
<ul>
<li>查找插入叶结点</li>
<li>若叶结点中有空闲位置（键），则插入</li>
<li>若没有空间，则分裂叶结点</li>
<li>叶结点的分裂可视作是父结点中插入一个子结点</li>
<li>递归向上分裂</li>
<li>分裂过程中需要对父结点中的键加以调整</li>
<li>例外：若根结点分裂，则需要创建一个新的根结点<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191711067.png" alt="" /></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191711582.png" alt="" /><br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191712621.png" alt="" /><br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191714640.png" alt="" /></p>
<h3 id="655-b树删除"><a class="markdownIt-Anchor" href="#655-b树删除"></a> 6.5.5 B+树删除</h3>
<ul>
<li>查找要删除的键值，并删除之</li>
<li>若结点的键值填充低于规定值，则调整
<ul>
<li>若相邻的叶结点中键填充高于规定值，则将其中一个键值移到该结点中</li>
<li>否则，合并该结点与相邻结点
<ul>
<li>合并可视作在父结点中删除一个子结点</li>
</ul>
</li>
<li>递归向上删除</li>
</ul>
</li>
<li>若删除的是叶结点中的最小键值，则需对父结点的键值加以调整<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191715518.png" alt="" /></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191715698.png" alt="" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191715919.png" alt="" /></p>
<h3 id="656-b树的效率"><a class="markdownIt-Anchor" href="#656-b树的效率"></a> 6.5.6 B+树的效率</h3>
<ul>
<li>访问索引的 I/O 代价＝树高（ B ＋树不常驻内存）或者 0（常驻内存）</li>
<li>树高通常不超过 3 层，因此索引 I/O 代价不超过 3（总代价不超过 4）</li>
<li>通常情况下，根节点常驻内存，因此索引 I/O 代价不超过 2（总代价不超过 3）</li>
</ul>
<p>设块大小 8KB，键 2B（ smallint），指针 2B，则一个块可放 2048 个索引项<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302191716886.png" alt="" /></p>
<h2 id="66-散列表hash-table"><a class="markdownIt-Anchor" href="#66-散列表hash-table"></a> 6.6 散列表(Hash Table)</h2>
<p>散列函数(Hash Functions)<br />
h：查找键（散列键）-&gt;<code>[0,...,B-1]</code><br />
桶（Buckets）：numbered 0,1,…,B-1<br />
散列索引方法：</p>
<ul>
<li>给定一个查找键 K，对应的记录必定位于桶 h(K)中</li>
<li>若一个桶中仅一块，则 IO 次数=1</li>
<li>否则由参数 B 决定，平均=总块数/B<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302210925960.png" alt="" /></li>
</ul>
<h3 id="661-散列表查找"><a class="markdownIt-Anchor" href="#661-散列表查找"></a> 6.6.1 散列表查找</h3>
<ul>
<li>对于给定散列键值 K，计算 h(K)</li>
<li>根据 h(K)定位桶</li>
<li>查找桶总的块</li>
</ul>
<h3 id="662-散列表的插入"><a class="markdownIt-Anchor" href="#662-散列表的插入"></a> 6.6.2 散列表的插入</h3>
<ul>
<li>计算插入记录的 h(K)，定位桶</li>
<li>若桶中有空间，则插入</li>
<li>否则创建一个溢出块并将记录置于溢出块中<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302210930896.png" alt="" /></li>
</ul>
<h3 id="663-散列表的删除"><a class="markdownIt-Anchor" href="#663-散列表的删除"></a> 6.6.3 散列表的删除</h3>
<ul>
<li>根据给定键值 K 计算 h(K)，定位桶和记录</li>
<li>删除<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302210931845.png" alt="" /></li>
</ul>
<h3 id="664-散列表空间利用率"><a class="markdownIt-Anchor" href="#664-散列表空间利用率"></a> 6.6.4 散列表空间利用率</h3>
<p>实际键值数/所有桶可放置的键值数</p>
<ul>
<li>&lt;50%：空间浪费</li>
<li>
<blockquote>
<p>80%：溢出问题</p>
</blockquote>
</li>
<li>50%~80%之间：Good</li>
</ul>
<h3 id="665-可扩展散列表"><a class="markdownIt-Anchor" href="#665-可扩展散列表"></a> 6.6.5 可扩展散列表</h3>
<p>散列函数 h(K)是一个 b(足够大)位二进制序列，前<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> 位表示桶的数目</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> 值随文件的增长而增大</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302210935793.png" alt="" /></p>
<ul>
<li>前<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> 位构成一个桶数组</li>
</ul>
<p>优点：</p>
<ul>
<li>大部分情况下不存在溢出块，因此当查找记录时，只需查找一个存储块</li>
</ul>
<p>缺点：</p>
<ul>
<li>桶增长速度快</li>
<li>可能导致内存存放不下整个桶数组</li>
<li>影响其他保存在主存中的数据，波动较大</li>
</ul>
<h3 id="666-线性散列表"><a class="markdownIt-Anchor" href="#666-线性散列表"></a> 6.6.6 线性散列表</h3>
<p>使用右边<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> 位区分桶</p>
<ul>
<li>桶数=n,h(k)的右 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> 位=m</li>
<li>若 m&lt;n, 则记录位于第 m 个桶</li>
<li>若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>≤</mo><mi>m</mi><mo>&lt;</mo><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">n\leq m &lt;2^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.824664em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span></span>,则记录位于第<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>−</mo><msup><mn>2</mn><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">m-2^{i-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.824664em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> 个桶</li>
<li>n 的选择：总是使 n 与当前总数 r 保存某个固定比例
<ul>
<li>意味着只有当桶的填充度达到超过某个比例后桶数才开始增长</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302210942814.png" alt="" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302210942897.png" alt="" /></p>
<ul>
<li>空间效率优于可扩展散列表</li>
<li>查找性能比可扩展散列表差</li>
<li>综合性能较好</li>
</ul>
<h1 id="7-查询优化"><a class="markdownIt-Anchor" href="#7-查询优化"></a> 7 查询优化</h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302200948554.png" alt="" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302200949537.png" alt="" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302200949713.png" alt="" /></p>
<h2 id="71-语法分析parsing"><a class="markdownIt-Anchor" href="#71-语法分析parsing"></a> 7.1 语法分析(Parsing)</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> title</span><br><span class="line"><span class="keyword">FROM</span> StarsIn</span><br><span class="line"><span class="keyword">WHERE</span> starName <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> MovieStar</span><br><span class="line"><span class="keyword">WHERE</span> birthdate <span class="keyword">LIKE</span> ‘<span class="operator">%</span><span class="number">1960</span>’</span><br><span class="line">);</span><br><span class="line">(Find the movies <span class="keyword">with</span> stars born <span class="keyword">in</span> <span class="number">1960</span>)</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302200951270.png" alt="" /></p>
<h2 id="72-逻辑查询计划生成"><a class="markdownIt-Anchor" href="#72-逻辑查询计划生成"></a> 7.2 逻辑查询计划生成</h2>
<ul>
<li>将语法分析树转换为代数表达式树——逻辑<br />
查询计划<br />
Typical：关系代数</li>
</ul>
<h3 id="721-关系代数符号"><a class="markdownIt-Anchor" href="#721-关系代数符号"></a> 7.2.1 关系代数符号</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302200959408.png" alt="" /></p>
<h3 id="722-关系代数与-sql"><a class="markdownIt-Anchor" href="#722-关系代数与-sql"></a> 7.2.2 关系代数与 SQL</h3>
<p>关系代数是 SQL 的代数表达<br />
关系代数表达式 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⇔</mo></mrow><annotation encoding="application/x-tex">\Leftrightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">⇔</span></span></span></span> SQL 查询</p>
<ul>
<li>运算基于集合（SET）运算</li>
<li>SQL 基于包（BAG）运算</li>
<li>集合：无重复元素</li>
<li>包：允许重复元素</li>
</ul>
<h3 id="723-语法分析树"><a class="markdownIt-Anchor" href="#723-语法分析树"></a> 7.2.3 语法分析树</h3>
<p>将类似 SQL 这样的语言编写的文本转换成语法分析树。<br />
如可将 SQL 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> movieTitle <span class="keyword">From</span> StarsIn，MovieStar <span class="keyword">Where</span> starName <span class="operator">=</span> name <span class="keyword">AND</span> birthdate <span class="keyword">LIKE</span> <span class="string">&#x27;%1960</span></span><br></pre></td></tr></table></figure>
<p>转换成如下语法树：<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202110900.png" alt="" /></p>
<p>讲语法树转换成所希望的逻辑查询，需要分两步：<br />
a) 按适当的群组用一个或多个关系代数运算符替换语法树上的节点与结构，生成关系代数表达式。<br />
b) 利用代数定律，将第一步产生的关系代数表达式转换成我们所期望的一个表达式，它将被转换成物理查询计划。</p>
<p>关系代数表达式自底向上由以下内容组成：<br />
a）将<code>&lt;FromList&gt;</code>中提及的全部关系进行积运算，运算结果是选择运算符的参数。<br />
b）选择运算符 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">\sigma_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>就是要被替换的<code>&lt;Condition&gt;</code>表达式，同时选择的结果又是投影运算符的参数。<br />
c）投影<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Π</mi><mi>L</mi></msub></mrow><annotation encoding="application/x-tex">\Pi_L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span>是<code>&lt;SelList&gt;</code>中的属性列表。<br />
考虑第 1 节中的语法分析树，按照上述规则将其转换成代数表达式树，我们取<code>&lt;FromList&gt;</code>中的两个关系<code>StarsIn</code>与<code>MovieStar</code>的积，用<code>&lt;Condition&gt;</code>中的两个条件<code>starName=name</code>和<code>birthdate Like ‘%1960’</code>进行选择，并投影到<code>&lt;SelList&gt;</code>中的属性<code>movieTitle</code>上，所得的关系代数表达式为：<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202117951.png" alt="" /></p>
<h3 id="724-逻辑查询计划"><a class="markdownIt-Anchor" href="#724-逻辑查询计划"></a> 7.2.4 逻辑查询计划</h3>
<p>内节点：关系运算符<br />
叶节点：关系<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201002507.png" alt="" /></p>
<h2 id="73-查询重写"><a class="markdownIt-Anchor" href="#73-查询重写"></a> 7.3 查询重写</h2>
<ul>
<li>将初始逻辑查询计划转换为优化的逻辑查询计划(Maybe)</li>
<li>基于代数转换规则<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201004307.png" alt="" /></li>
</ul>
<h3 id="731-转换规则"><a class="markdownIt-Anchor" href="#731-转换规则"></a> 7.3.1 转换规则</h3>
<ul>
<li>Transformation rules</li>
<li>运用转换规则，将一个代数表达式转换为另一个等价的代数表达式</li>
</ul>
<p>目的：</p>
<ul>
<li>
<p>减少查询的开销(I/O 次数)</p>
</li>
<li>
<p>减少查询执行时的中间关系大小（元组数）</p>
</li>
<li>
<p>减少元组的大小</p>
</li>
<li>
<p>涉及自然连接、并、交、笛卡儿积的交换律和结合律</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext> - </mtext><mi mathvariant="bold">R</mi><mo>×</mo><mi mathvariant="bold">S</mi><mo>=</mo><mi mathvariant="bold">S</mi><mo>×</mo><mi mathvariant="bold">R</mi><mo separator="true">;</mo><mo stretchy="false">(</mo><mi mathvariant="bold">R</mi><mo>×</mo><mi mathvariant="bold">S</mi><mo stretchy="false">)</mo><mo>×</mo><mi mathvariant="bold">T</mi><mo>=</mo><mi mathvariant="bold">R</mi><mo>×</mo><mo stretchy="false">(</mo><mi mathvariant="bold">S</mi><mo>×</mo><mi mathvariant="bold">T</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext> - </mtext><mi>R</mi><mo>⋈</mo><mi>S</mi><mo>=</mo><mi>S</mi><mo>⋈</mo><mi>R</mi><mo separator="true">;</mo><mtext>（</mtext><mi>R</mi><mo>⋈</mo><mi>S</mi><mtext>）</mtext><mo>⋈</mo><mi>T</mi><mo>=</mo><mi>R</mi><mo>⋈</mo><mtext>（</mtext><mi>S</mi><mo>⋈</mo><mi>T</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext> - </mtext><mi mathvariant="bold">R</mi><mo>∪</mo><mi mathvariant="bold">S</mi><mo>=</mo><mi mathvariant="bold">S</mi><mo>∪</mo><mi mathvariant="bold">R</mi><mo separator="true">;</mo><mo stretchy="false">(</mo><mi mathvariant="bold">R</mi><mo>∪</mo><mi mathvariant="bold">S</mi><mo stretchy="false">)</mo><mo>∪</mo><mi>T</mi><mo>=</mo><mi>R</mi><mo>∪</mo><mo stretchy="false">(</mo><mi>S</mi><mo>∪</mo><mi>T</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext> - </mtext><mi mathvariant="bold">R</mi><mo>∩</mo><mi mathvariant="bold">S</mi><mo>=</mo><mi mathvariant="bold">S</mi><mo>∩</mo><mi mathvariant="bold">R</mi><mo separator="true">;</mo><mo stretchy="false">(</mo><mi mathvariant="bold">R</mi><mo>∩</mo><mi mathvariant="bold">S</mi><mo stretchy="false">)</mo><mo>∩</mo><mi mathvariant="bold">T</mi><mo>=</mo><mi mathvariant="bold">R</mi><mo>∩</mo><mo stretchy="false">(</mo><mi mathvariant="bold">S</mi><mo>∩</mo><mi mathvariant="bold">T</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
&amp; \text { - } \mathbf{R} \times \mathbf{S}=\mathbf{S} \times \mathbf{R} ;(\mathbf{R} \times \mathbf{S}) \times \mathbf{T}=\mathbf{R} \times(\mathbf{S} \times \mathbf{T}) \\
&amp; \text { - } R \bowtie S=S \bowtie R ; （ R \bowtie S ） \bowtie T=R \bowtie （ S \bowtie T) \\
&amp; \text { - } \mathbf{R} \cup \mathbf{S}=\mathbf{S} \cup \mathbf{R} ;(\mathbf{R} \cup \mathbf{S}) \cup T=R \cup(S \cup T) \\
&amp; \text { - } \mathbf{R} \cap \mathbf{S}=\mathbf{S} \cap \mathbf{R} ;(\mathbf{R} \cap \mathbf{S}) \cap \mathbf{T}=\mathbf{R} \cap(\mathbf{S} \cap \mathbf{T}) \\
&amp;
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.500000000000002em;vertical-align:-3.5000000000000018em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em;"><span style="top:-6em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span><span style="top:-4.499999999999999em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span><span style="top:-2.9999999999999982em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span><span style="top:-1.4999999999999982em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span><span style="top:1.7763568394002505e-15em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5000000000000018em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em;"><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord"> - </span></span><span class="mord"><span class="mord mathbf">R</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">S</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathbf">S</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">R</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">R</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">S</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">T</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathbf">R</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">S</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">T</span></span><span class="mclose">)</span></span></span><span style="top:-4.659999999999999em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord"> - </span></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">（</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord cjk_fallback">）</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord cjk_fallback">（</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span><span style="top:-3.1599999999999984em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord"> - </span></span><span class="mord"><span class="mord mathbf">R</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">S</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathbf">S</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">R</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">R</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">S</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span><span style="top:-1.6599999999999984em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord"> - </span></span><span class="mord"><span class="mord mathbf">R</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">S</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathbf">S</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">R</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">R</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">S</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">T</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathbf">R</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">S</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathbf">T</span></span><span class="mclose">)</span></span></span><span style="top:-0.15999999999999837em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5000000000000018em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201006765.png" alt="" /></p>
</li>
</ul>
<h4 id="7311-选择转换"><a class="markdownIt-Anchor" href="#7311-选择转换"></a> 7.3.1.1 选择转换</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201008651.png" alt="" /></p>
<h4 id="7312-选择自然连接-转换"><a class="markdownIt-Anchor" href="#7312-选择自然连接-转换"></a> 7.3.1.2 选择+自然连接 转换</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201009052.png" alt="" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201009037.png" alt="" /></p>
<h4 id="7313-投影自然连接-转换"><a class="markdownIt-Anchor" href="#7313-投影自然连接-转换"></a> 7.3.1.3 投影+自然连接 转换</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201009534.png" alt="" /></p>
<h2 id="74-查询计划代价估计"><a class="markdownIt-Anchor" href="#74-查询计划代价估计"></a> 7.4 查询计划代价估计</h2>
<h3 id="741-中间结果的大小估计"><a class="markdownIt-Anchor" href="#741-中间结果的大小估计"></a> 7.4.1 中间结果的大小估计</h3>
<ul>
<li>
<p>需要使用一些统计量(statistics)<br />
T®|R 的元组数<br />
-|-<br />
S®|R 中每个元组的大小(bytes)<br />
V(R, A) |R 的属性 A 上的不同值数<br />
B®|容纳 R 所有元组所需的块数</p>
</li>
<li>
<p>These statistics should be held in the database!<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201012762.png" alt="" /></p>
</li>
</ul>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><msub><mi>R</mi><mn>1</mn></msub><mo>×</mo><msub><mi>R</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">W=R_1\times R_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的大小估计：</p>
<p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: align at position 7: \begin{̲a̲l̲i̲g̲n̲}̲
T(W)&amp;=T(R_1)*T…'>\begin{align}
T(W)&amp;=T(R_1)*T(R_2)\\
S(W)&amp;=S(R_1)+S(R_2)
\end{align}
</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><msub><mi>σ</mi><mrow><mi>z</mi><mo>=</mo><mi>v</mi><mi>a</mi><mi>l</mi></mrow></msub><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">W=\sigma_{z=val}(R)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mclose">)</span></span></span></span><br />
假设 z 上的值在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo stretchy="false">(</mo><mi>R</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">V(R,z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span>个不同值上均匀分布</p>
<p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: align at position 7: \begin{̲a̲l̲i̲g̲n̲}̲
S(W)&amp;=S(R)\\
T…'>\begin{align}
S(W)&amp;=S(R)\\
T(W)&amp;=\frac{T(R)}{V(R,z)}
\end{align}
</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><msub><mi>σ</mi><mrow><mi>z</mi><mo>&gt;</mo><mi>v</mi><mi>a</mi><mi>l</mi></mrow></msub><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">W=\sigma_{z&gt;val}(R)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999985em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span><span class="mrel mtight">&gt;</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.17737em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mclose">)</span></span></span></span></p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo stretchy="false">(</mo><mi>W</mi><mo stretchy="false">)</mo><mo>=</mo><mi>T</mi><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">T(W)=T(R)/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">2</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo stretchy="false">(</mo><mi>W</mi><mo stretchy="false">)</mo><mo>=</mo><mi>T</mi><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>3</mn></mrow><annotation encoding="application/x-tex">T(W)=T(R)/3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">3</span></span></span></span></li>
<li>使用“范围”<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201020294.png" alt="" /></li>
</ul>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><msub><mi>σ</mi><mrow><mi>z</mi><mo mathvariant="normal">≠</mo><mi>v</mi><mi>a</mi><mi>l</mi></mrow></msub><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">W=\sigma_{z\neq val}(R)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel mtight"></span></span><span class="fix"></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mclose">)</span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><mo stretchy="false">(</mo><mi>W</mi><mo stretchy="false">)</mo><mo>=</mo><mi>T</mi><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo><mo>−</mo><mfrac><mrow><mi>T</mi><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo></mrow><mrow><mi>V</mi><mo stretchy="false">(</mo><mi>R</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">T(W)=T(R)-\frac{T(R)}{V(R,z)}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201021726.png" alt="" /></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><msub><mi>R</mi><mn>1</mn></msub><mo>⋈</mo><msub><mi>R</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">W=R_{1} \bowtie R_{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<ul>
<li>令 x 是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">R_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的属性，y 是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">R_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的属性<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201024128.png" alt="" /></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201502950.png" alt="" /></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><mo stretchy="false">(</mo><mi>W</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>T</mi><mo stretchy="false">(</mo><mi>R</mi><mn>1</mn><mo stretchy="false">)</mo><mo>⋅</mo><mi>T</mi><mo stretchy="false">(</mo><mi>R</mi><mn>2</mn><mo stretchy="false">)</mo></mrow><mrow><mi>max</mi><mo>⁡</mo><mo stretchy="false">{</mo><mi>V</mi><mo stretchy="false">(</mo><mi>R</mi><mn>1</mn><mo separator="true">,</mo><mi>A</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">(</mo><mi>R</mi><mn>2</mn><mo separator="true">,</mo><mi>A</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">T(W)=\frac{T(R 1) \cdot T(R 2)}{\max \{V(R 1, A), V(R 2, A)\}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">max</span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">A</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">A</span><span class="mclose">)</span><span class="mclose">}</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord">2</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>W</mi><mo stretchy="false">)</mo><mo>=</mo><mi>S</mi><mo stretchy="false">(</mo><msub><mi>R</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mi>S</mi><mo stretchy="false">(</mo><msub><mi>R</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>−</mo><mi>S</mi><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(W)=S(R_1)+S(R_2)-S(A)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mclose">)</span></span></span></span><br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201504291.png" alt="" /></p>
<h3 id="742-io-代价"><a class="markdownIt-Anchor" href="#742-io-代价"></a> 7.4.2 IO 代价</h3>
<p>估计查询计划必须读写磁盘块的 sumu<br />
需要另一些参数</p>
<ul>
<li>B®： R 所需的块数</li>
<li>f®：每块可容纳的 R 的最大元组数</li>
<li>M：可用的内存块数</li>
<li>HT(i)：索引 i 的层数</li>
<li>LB(i)：索引 i 的叶结点所需的块数</li>
</ul>
<h3 id="743-影响查询计划-io-代价的因素"><a class="markdownIt-Anchor" href="#743-影响查询计划-io-代价的因素"></a> 7.4.3 影响查询计划 IO 代价的因素</h3>
<ul>
<li>实现查询计划的逻<strong>辑操作符</strong>
<ul>
<li>在选择逻辑查询计划时已确定</li>
</ul>
</li>
<li>中间结果的大小 already discussed！</li>
<li>实现逻辑操作符的<strong>物理操作符</strong> Next
<ul>
<li>例如，连接操作是用索引连接还是散列连接？</li>
</ul>
</li>
<li>相似操作的<strong>顺序</strong> see Sec.16.6
<ul>
<li>例如，多关系的连接顺序</li>
</ul>
</li>
<li>物理操作符之间的<strong>参数传递方式</strong> see Sec.16.7
<ul>
<li>Pipeline（流水线）还是 Materization（物化）？</li>
</ul>
</li>
</ul>
<h3 id="744-物理操作符之间的参数传递"><a class="markdownIt-Anchor" href="#744-物理操作符之间的参数传递"></a> 7.4.4 物理操作符之间的参数传递</h3>
<ul>
<li>
<p>物化方式</p>
<ul>
<li>操作依次执行，并且每个操作的结果（中间关系）都写到磁盘上供其它操作存取</li>
<li>通过磁盘物理进行数据传递</li>
<li>节省主存空间</li>
</ul>
</li>
<li>
<p>流水线</p>
<ul>
<li>多个操作同时执行，一个操作产生的元组直接通过共享内存传递给其它操作</li>
<li>节省 I/O</li>
<li>但占用主存，若缓冲区出现“颠簸”则 I/O 增加</li>
</ul>
</li>
</ul>
<h2 id="75-物理查询计划选择"><a class="markdownIt-Anchor" href="#75-物理查询计划选择"></a> 7.5 物理查询计划选择</h2>
<p>物理查询计划生成</p>
<ul>
<li>逻辑查询计划</li>
<li>估计中间关系大小</li>
<li>为逻辑操作符选择物理操作符</li>
<li>确定其它物理操作符</li>
<li>确定物理操作符的顺序</li>
<li>确定物理操作之间的参数传递方式<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201509475.png" alt="" /></li>
</ul>
<h2 id="76-ms-sql-server-查询优化"><a class="markdownIt-Anchor" href="#76-ms-sql-server-查询优化"></a> 7.6 MS SQL Server 查询优化</h2>
<ul>
<li>语法分析</li>
<li>查询树生成</li>
<li>逻辑优化：逻辑查询计划等价转换</li>
<li>基于代价的物理优化</li>
</ul>
<h3 id="761-执行计划"><a class="markdownIt-Anchor" href="#761-执行计划"></a> 7.6.1 执行计划</h3>
<ul>
<li>查询计划： 只读数据结构，可由任意数量的用户使用。这称为查询计划。</li>
<li>执行环境： 每个正在执行查询的用户都有一个包含其执行专用数据（如参数值）的数据结构。该数据结构称为执行环境。执行环境数据结构可以重新使用<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201510144.png" alt="" /></li>
</ul>
<h3 id="762-执行计划的缓存和重用"><a class="markdownIt-Anchor" href="#762-执行计划的缓存和重用"></a> 7.6.2 执行计划的缓存和重用</h3>
<ul>
<li>在 MS SQL Server 中执行任何 SQL 语句时，关系引擎将首先查看缓存中是否有用于同一 SQL 语句的现有执行计划。 MS SQL Server 重新使用所找到的任何现有计划以节省重新编译 SQL 语句的开销。</li>
<li>如果没有现有执行计划，则 MS SQL Server 将为查询生成新的执行计划。</li>
</ul>
<h3 id="763-执行计划的老化"><a class="markdownIt-Anchor" href="#763-执行计划的老化"></a> 7.6.3 执行计划的老化</h3>
<ul>
<li>
<p>缓存中的每个执行计划都有相关的编译成本因子和一个年龄字段。执行计划每由连接引用一次，其年龄字段便按编译成本因子递增。<br />
例如，如果一个查询计划的成本因子是 8 且被引用了两次，它的年龄将变为 16。</p>
</li>
<li>
<p>惰性写入器进程定期扫描缓存内的对象列表。每扫描一次将年龄字段减少 1。如果满足下面三个条件，惰性写入器进程将释放对象：</p>
</li>
<li>
<p>内存管理器需要内存且所有可用内存都正在使用。</p>
</li>
<li>
<p>对象的年龄字段是 0。</p>
</li>
<li>
<p>对象在当前没有被连接引用。</p>
</li>
</ul>
<h3 id="764-执行计划的重编译"><a class="markdownIt-Anchor" href="#764-执行计划的重编译"></a> 7.6.4 执行计划的重编译</h3>
<p>需要重编译的情况</p>
<ul>
<li>对查询所引用的表进行任何结构更改。</li>
<li>通过语句（如 UPDATE STATISTICS）显式生成或者自动生成新的统计信息。</li>
<li>删除执行计划所使用的索引。</li>
<li>显式调用 sp_recompile。</li>
<li>对键的大量更改（其他用户对由查询引用的表使用 INSERT 或 DELETE 语句所产生的修改）。</li>
<li>对于带触发器的表， inserted 或 deleted 表内的行数显著增长。</li>
</ul>
<h3 id="765-执行计划例子"><a class="markdownIt-Anchor" href="#765-执行计划例子"></a> 7.6.5 执行计划例子</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> authors.au_fname, titles.title</span><br><span class="line"><span class="keyword">FROM</span> authors, titles, titleauthor</span><br><span class="line"><span class="keyword">WHERE</span> authors.au_id <span class="operator">=</span> titleauthor.au_id <span class="keyword">AND</span></span><br><span class="line">titleauthor.title_id <span class="operator">=</span> titles.title_id</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201514310.png" alt="" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201514679.png" alt="" /></p>
<h3 id="766-多阶段优化器"><a class="markdownIt-Anchor" href="#766-多阶段优化器"></a> 7.6.6 多阶段优化器</h3>
<ul>
<li>Trivial Plan 阶段：某些查询只有一个执行计划（如 Insert），优化器只需产生一个计划</li>
<li>Simplification 阶段：语法转换</li>
<li>Statistics Loading 阶段：装载代价估计所需的统计信息</li>
<li>Cost-Based Optimization 阶段：分阶段运用转换规则生成执行计划，并估计代价
<ul>
<li>事务处理查询阶段：使用简单转换规则</li>
<li>复杂查询阶段：使用包括连接、分组等的转换规则</li>
</ul>
</li>
</ul>
<h1 id="8-连接算法"><a class="markdownIt-Anchor" href="#8-连接算法"></a> 8 连接算法</h1>
<h2 id="81-基本概念"><a class="markdownIt-Anchor" href="#81-基本概念"></a> 8.1 基本概念</h2>
<h2 id="82-物理查询计划操作符"><a class="markdownIt-Anchor" href="#82-物理查询计划操作符"></a> 8.2 物理查询计划操作符</h2>
<h2 id="83-连接操作join的实现算法"><a class="markdownIt-Anchor" href="#83-连接操作join的实现算法"></a> 8.3 连接操作(Join)的实现算法</h2>
<h2 id="84-连接算法的代价分析"><a class="markdownIt-Anchor" href="#84-连接算法的代价分析"></a> 8.4 连接算法的代价分析</h2>
<h1 id="9-事务处理"><a class="markdownIt-Anchor" href="#9-事务处理"></a> 9 事务处理</h1>
<p>数据库保护：排除和防止各种对数据库的干扰破坏，确保数据安全可靠，以及在数据库遭到破坏后尽快地恢复</p>
<ul>
<li>数据库的恢复技术
<ul>
<li>Deal with failure</li>
</ul>
</li>
<li>并发控制技术
<ul>
<li>Deal with data sharing</li>
</ul>
</li>
<li>完整性控制技术
<ul>
<li>Enable constraints</li>
</ul>
</li>
<li>安全性控制技术
<ul>
<li>Authorization and authentication</li>
</ul>
</li>
</ul>
<h1 id="10-系统故障对策"><a class="markdownIt-Anchor" href="#10-系统故障对策"></a> 10 系统故障对策</h1>
<p>考虑两大问题：</p>
<ul>
<li>当系统故障发声时数据必须受到保护</li>
<li>数据不能仅仅因为几个本身无措的查询或数据库更新同时进行就受到破坏</li>
</ul>
<h2 id="101-故障模式"><a class="markdownIt-Anchor" href="#101-故障模式"></a> 10.1 故障模式</h2>
<h3 id="1011-事务故障"><a class="markdownIt-Anchor" href="#1011-事务故障"></a> 10.1.1 事务故障</h3>
<ul>
<li>发生在单个事务内部的故障可预期的事务故障：即应用程序可以发现的故障，如转帐时余额不足。由应用程序处理</li>
<li>非预期的事务故障：如运算溢出、死锁等，导致事务被异常中止。应用程序无法处理此类故障，由系统进行处理</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">or</span> Replace <span class="keyword">Procedure</span> Transfer</span><br><span class="line">(sender varchar2, receiver varchar2, amount number, val varchar2)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">a Number:<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">b Number:<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">exp Exception;</span><br><span class="line"><span class="keyword">Begin</span></span><br><span class="line"><span class="keyword">Select</span> balance <span class="keyword">into</span> a <span class="keyword">Where</span> ID<span class="operator">=</span>sender;</span><br><span class="line"><span class="keyword">Select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">Into</span> b <span class="keyword">From</span> accounts <span class="keyword">where</span> ID<span class="operator">=</span>receiver <span class="keyword">and</span> name<span class="operator">=</span>val;</span><br><span class="line">If a<span class="operator">&lt;=</span>amount <span class="keyword">or</span> b<span class="operator">=</span><span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">Raise exp; <span class="comment">--生成一个异常;</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line"><span class="keyword">Update</span> account <span class="keyword">Set</span> balance<span class="operator">=</span>balance<span class="operator">+</span><span class="number">100</span> <span class="keyword">where</span> ID<span class="operator">=</span>‘B’;</span><br><span class="line"><span class="keyword">Update</span> account <span class="keyword">Set</span> balance<span class="operator">=</span>balance<span class="number">-100</span> <span class="keyword">where</span> ID<span class="operator">=</span>‘A’;</span><br><span class="line"><span class="keyword">End</span> If</span><br><span class="line"><span class="keyword">Commit</span>;</span><br><span class="line">EXCEPTION</span><br><span class="line"><span class="keyword">When</span> exp <span class="keyword">Then</span></span><br><span class="line"><span class="keyword">Rollback</span>;</span><br><span class="line">Raise_Application_Error(<span class="number">-20001</span>, ‘余额不足或接收方账号有误’);</span><br><span class="line"><span class="keyword">End</span></span><br></pre></td></tr></table></figure>
<h3 id="1012-数据错误输入"><a class="markdownIt-Anchor" href="#1012-数据错误输入"></a> 10.1.2 数据错误输入</h3>
<p>有的数据错误是不可能被检测到的。<br />
例如, 如果某个职员把你的电话号码中的一位输错了, 数据仍然看起来可能是你的电话号码。但是, 如果职员遗漏了你的电话号码中的一位, 数据就显然是错的了, 因为它不具有电话号码应有的格式。处<br />
理数据输人错误的主要技术就是编写<strong>约束</strong>和<strong>触发器</strong>来找出被认为是错误的数据。</p>
<h3 id="1013-介质故障"><a class="markdownIt-Anchor" href="#1013-介质故障"></a> 10.1.3 介质故障</h3>
<p>磁盘的局部故障, 即只改变一位或少数几位的故障, 通常能通过与磁盘扇区相关联的奇偶 校验检测到,<br />
磁头损坏, 使整个磁盘都不再能被访问, 这时通常用下述方法中的一个或两个来处理：</p>
<ol>
<li>采用某种 RAID 模式, 这样丢失的磁盘就可以被恢复。</li>
<li>维护一个备份, 即数据库在诸如磁带或光盘这样的某种介质上的一个拷贝。备份周期性创建，存储在原理数据库自身的某个安全的距离外</li>
<li>不采用备份，而是联机保存数据库的冗余考虑，分布在几个节点</li>
</ol>
<h3 id="1014-灾难性故障"><a class="markdownIt-Anchor" href="#1014-灾难性故障"></a> 10.1.4 灾难性故障</h3>
<p>这类故障包括容纳数据库的介质完全毁坏的多种情况<br />
例如数据库所在结点发生爆炸或大 火以及恶意破坏。RAID 不会带来任何帮助, 因为所有的数据盘及其奇偶校验盘同时失去作用。 但是, 用于防止介质故障的其他方法 (备份和宄余、分布的拷贝) 也可以用来防止灾难性故障。</p>
<h3 id="1015-系统故障"><a class="markdownIt-Anchor" href="#1015-系统故障"></a> 10.1.5 系统故障</h3>
<p>查询和修改数据库的进程称为事务。事务和其他任何程序一样执行一系列步骤, 通常这些 步骤中的一部分将修改数据库。每个事务有一个状态, 代表该事务中到目前为止已发生了什么。 状态包括所执行事务代码中的当前位置和所有以后将会需要的事务局部变量的值。系统故障是导致事务状态丢失的问题。</p>
<p>典型的系统故障包括掉电和软件错误。由于内存是 “易失性的”, 于是掉电会导致主存中的内容消失, 只保存于主存中的任何事务步骤的结果也同时消失了, 这和磁盘 (非易失性) 的情况不同。<br />
类似地, 一个软件错误可能覆盖主存的一部分内容, 也许包括构成程序状态的值。当主存丢失时, 事务状态就丢失了; 也就是说, 我们不再能确定事务的哪些部分 (包括它对数据库的修改) 已经进行。重新运行事务不一定能修复问题。<br />
例如, 如果事务必须将数据库中的 某个值加 1 , 我们并不知道到底是否应该再重复加 1 。解决由系统错误所引起问题的基本方法是在分离的、非易失性的日志中记录所有数据库更新, 必要时加以恢复。但是, 要保证这样的日志 记载能以一种不受故障干扰的方式进行, 其机制非常复杂。</p>
<ol>
<li>未完成事务对数据库的更新可能已部分写入数据库</li>
<li>已提交事务对数据库的更新可能还留在缓冲区没来得及写入数据库</li>
</ol>
<h2 id="102-日志"><a class="markdownIt-Anchor" href="#102-日志"></a> 10.2 日志</h2>
<p>日志是日志记录构成的文件, 每个日志记录记载有关某个事务已做的事的某些情况。<br />
如果日志记录出现在非易失性的存储器中, 那么在系统崩溃之后, 我们就可以使用它们来将数据库恢复到一个一致性状态。</p>
<p>我们的第一种日志类型是 undo 日志, 它通过撤销事务在系统崩溃前可 能还没有完成的影响来修复数据库状态。<br />
另外, 在这一节里我们要介绍日志记录的基本思想, 包括提交 (事务的成功完成) 动作及其 对数据库状态和日志的影响。我们还将考虑日志自身如何在主存中创建并被“刷新日志”操作拷贝到磁盘上。最后, 我们要具体地看一看 undo 日志, 懂得从崩溃中恢复时如何利用它。为了避免在恢复时不得不检查整个日志, 我们引人 “检查点” 这一想法, 它使得我们可以抛弃日志中旧 的部分。</p>
<p>为什么事务可能中止?<br />
读者可能会疑惑为什么事务会中止而不是提交。事实上原因有几个。最简单的是在事务 自身的代码中有某些错误情况<br />
例如试图用零做除数。DBMS 也可能由于一个或多个原因需要中止事务。<br />
例如, 事务可能陷入死锁中, 这时该事务和其他的一个或多个事务各自占有其他事务等待的某个资源。于是, 系统必须强迫一个或多个事务中止（见 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8.2</mn></mrow><annotation encoding="application/x-tex">8.2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span><span class="mord">.</span><span class="mord">2</span></span></span></span> 节)。</p>
<h3 id="1021-undo-日志"><a class="markdownIt-Anchor" href="#1021-undo-日志"></a> 10.2.1 undo 日志</h3>
<p>内容：</p>
<ul>
<li><strong>事务的开始标记<code>&lt;Start T&gt;</code></strong></li>
<li><strong>事务的结束标记（ <code>&lt;Commit, T&gt;</code>或<code>&lt;Abort T&gt;</code>）</strong></li>
<li><strong>事务的更新操作记录，一般包括以下内容</strong>
<ul>
<li>执行操作的事务标识</li>
<li>操作对象</li>
<li>更新前值（插入为空）</li>
</ul>
</li>
</ul>
<p><strong>WAL 日志(Write Ahead Logging)</strong> 先写日志</p>
<p>只要事务和缓冲区管理器遵从以下两条规则, undo 日志就能保证从系统故障中恢复。<br />
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">U_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> : 如果事务 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 改变了数据库元素 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>, 那么形如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>T</mi><mo separator="true">,</mo><mi>X</mi><mo separator="true">,</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo>−</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&lt;T, X, old-value&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span> 的日志记录必须在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 的新值写 到磁盘之前写到磁盘中。<br />
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">U_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> : 如果事务提交, 则其 <code>&lt;COMMIT,T&gt;</code> 日志记录必须在事务改变的所有数据库元素先写到磁盘 之后写到磁盘中, 但应尽快。</p>
<p>其他日志方式预览</p>
<ul>
<li>
<p>在“redo 日志” 中, 恢复时我们重做所有有 COMMIT 记录的事务并忽略所有其他 事务。redo 日志的规则保证我们可以忽略那些 COMMIT 记录尚末写入磁蛊上日志中的事务。</p>
</li>
<li>
<p>“undo/redo 日志” (在恢复时撤销所有末提交的事务, 重做已提交的事务。同样, 关于日志和缓冲区管理的规则保证这些步骤能成功地修复数据库的任何损坏。</p>
</li>
</ul>
<p>简要概括规则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">U_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">U_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, 与一个事务相关的内容必须按如下顺序写到磁盘:<br />
a) 指明所改变数据库元素的日志记录。<br />
b) 改变的数据库元素自身。<br />
c) COMMIT 日志记录。</p>
<blockquote>
<p>undo 日志的设计方式，所给的是旧值，恢复数据是幂等的，重复多次与执行一次效果完全相同<br />
再次恢复时，不必考虑前一次恢复所作的更改</p>
</blockquote>
<p>每次写操作执行两次 write：</p>
<ul>
<li>write data</li>
<li>write log<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201638245.png" alt="" /></li>
</ul>
<h3 id="1022-redo-日志"><a class="markdownIt-Anchor" href="#1022-redo-日志"></a> 10.2.2 redo 日志</h3>
<p>undo 日志有一个潜在的问题, 即我们在将事务改变的所有数据写到磁盘前不能提交该事务。 有时, 如果让数据库修改暂时只存在于主存中, 我们可以节省磁盘 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">/</mi><mi mathvariant="normal">O</mi></mrow><annotation encoding="application/x-tex">\mathrm{I} / \mathrm{O}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">I</span></span><span class="mord">/</span><span class="mord"><span class="mord mathrm">O</span></span></span></span></span>; 只要在崩溃发生时有日志可以用来修复, 这样做是安全的。</p>
<p>如果我们使用一种称为 redo 日志的日志机制, 立即将数据库元素备份到磁盘的需要就可以 被避免。redo 日志和 undo 日志的主要区别是：</p>
<ol>
<li>undo 日志在恢复时消除末完成事务的影响并忽略已提交事务, 而 redo 日志忽略末完成的 事务并重复已提交事务所做的改变。</li>
<li>undo 日志要求我们在 COMMIT 日志记录到达磁盘前将修改后的数据库元素写到磁盘, 而 redo 日志要求 COMMIT 记录在任何修改后的值到达磁盘前出现在磁盘上。</li>
<li>当遵循 undo 规则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">U_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">U_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 时, 在恢复时我们需要的是发生改变的数据库元素的旧值, 而 使用 redo 日志恢复时, 我们需要的是新值。</li>
</ol>
<p>对于 redo 日志, 数据和日志项到达磁盘的顺序可以用一条 “redo 规则” 描述, 这条规则称为 先写日志规则。<br />
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">R_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> : 在修改磁盘上的任何数据库元素 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 以前, 要保证与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 的这一修改相关的所有的日志记录, 包括更新记录 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>T</mi><mo separator="true">,</mo><mi>X</mi><mo separator="true">,</mo><mi>v</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&lt;T, X, v&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span> 及&lt;COMMIT <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">T&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span> 记录, 都必须出现在磁盘上。<br />
事务的 COMMIT 记录只有在事务完成后才能写人日志, 因而提交记录必然在所有更新日志 记录后, 所以当使用 redo 日志时, 与一个事务相关的材料写到磁盘的顺序为:</p>
<ol>
<li>指出被修改元素的日志记录。</li>
<li>COMMIT 日志记录。</li>
<li>改变的数据库元素自身。</li>
</ol>
<p>redo 规则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">R_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的一个重要的推论是, 只要日志中没有 &lt; COMMIT <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">T&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span> 记录, 我们就知道事务 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 对数据库所做的更新都没有写到磁盘上。因此, 恢复时对末完成事务的处理就可以像它们从末发生过似的。然而, 已提交的事务存在问题, 因为我们不知道它们的哪些数据库改变已经写到磁盘。幸运的是, redo 日志正好有我们需要的信息: 新值。我们可以将新值写到磁盘而不管它们是否已经在磁盘上。在系统崩溃后要使用 redo 日志恢复, 我们需要做以下事情:</p>
<ol>
<li>确定已提交的事务。</li>
<li>从首部开始扫描日志。对遇到的每一 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⟨</mo><mi>T</mi><mo separator="true">,</mo><mi>X</mi><mo separator="true">,</mo><mi>v</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">\langle T, X, v&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">⟨</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span> 记录:<br />
a) 如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 是末提交的事务, 则什么也不做。<br />
b) 如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 是提交的事务, 则为数据库元素 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 写人值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mtext>。 </mtext></msub></mrow><annotation encoding="application/x-tex">v_{\text {。 }}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">。</span><span class="mord mtight"> </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>对每个末完成的事务 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>, 在日志中写人一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo></mrow><annotation encoding="application/x-tex">&lt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span></span></span></span> ABORTT <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span></span></span></span> 记录并刷新日志。</li>
</ol>
<h3 id="1023-undoredo-日志"><a class="markdownIt-Anchor" href="#1023-undoredo-日志"></a> 10.2.3 undo/redo 日志</h3>
<p>undo/redo 日志与其他日志类型有同样种类的日志记录, 只有一个例外。当数据库元素修改其值时我们写人的更新日志记录有 4 个成分。记录 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>T</mi><mo separator="true">,</mo><mi>X</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">,</mo><mi>w</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&lt;T, X, v, w&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span> 的含义是, 事务 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 改变了数据库元素 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 的值; 其改前值为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span>, 新值为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mo lspace="0em" rspace="0em">∘</mo></msub></mrow><annotation encoding="application/x-tex">w_{\circ}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16111499999999998em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∘</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> undo/redo 日志系统必须遵从的约束可用如下规则 概括:<br />
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">U R_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> : 在由于某个事务 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 所做改变而修改磁盘上的数据库元素 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 前, 更新记录 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⟨</mo><mi>T</mi><mo separator="true">,</mo><mi>X</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">,</mo><mi>w</mi><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">\langle T, X, v, w\rangle</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">⟨</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mclose">⟩</span></span></span></span> 必须出现在磁盘上。<br />
于是 undo/redo 日志的规则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">U R_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 只实施 undo 日志和 redo 日志都有的约束。具体地说, &lt; COMMIT <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">T&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span> 日志记录可以在磁盘上任何数据库元素的修改之前或之后。</p>
<p>恢复：<br />
当我们需要用 undo/redo 日志恢复时, 我们拥有的信息既允许我们通过恢复事务 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 所改变数 据库元素的旧值来撤销事务 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>, 也允许我们通过重复 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 所做的改变来重做 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mtext>。 undo/redo 日志恢复 </mtext></msub></mrow><annotation encoding="application/x-tex">T_{\text {。 undo/redo 日志恢复 }}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.03853em;vertical-align:-0.3551999999999999em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">。</span><span class="mord mtight"> undo/redo </span><span class="mord cjk_fallback mtight">日志恢复</span><span class="mord mtight"> </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span></span></span></span> 策略是:</p>
<ol>
<li>按照从前往后做顺序, 重做所有已提交的事务。</li>
<li>按照从后往前做顺序, 撤销所有末提交的事务。<br />
请注意这两件事都做对我们来说是必要的。由于 undo/redo 日志在 COMMIT 日志记录与数据 库修改本身拷贝到磁盘的相对顺序方面提供的灵活性, 我们既可以让一个已提交事务的部分或 全部修改不在磁盘上, 也可以让一个末提交事务的部分或全部修改在磁盘上。</li>
</ol>
<h3 id="1024-检查点"><a class="markdownIt-Anchor" href="#1024-检查点"></a> 10.2.4 检查点</h3>
<p>当需要进行恢复时，原则上所有的恢复方式都需要查看整个日志，DBMS 必须不时地对日志做检查点，以<strong>保证检查点以前的日志记录在恢复中不再需要</strong>。因此，旧的日志记录最终可以被丢弃，而其磁盘空间也可以被重用</p>
<p>非静止检查点：为了避免做检查点时关闭系统，与每一种日子方式相关的技术使检查点可以在系统运行且数据库改变发生时进行。唯一的代价是恢复时非静止检查点前的日志记录可能需要检查。</p>
<h2 id="103-日志轮转技术"><a class="markdownIt-Anchor" href="#103-日志轮转技术"></a> 10.3 日志轮转技术</h2>
<ul>
<li>数据库日志产生很快，会占用很多的磁盘存储。但大部分日志随时间推移实际上已<br />
经失效了</li>
<li>采用 Log Rotation 节省存储<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201644840.png" alt="" /></li>
</ul>
<h2 id="104-数据库系统故障恢复策略"><a class="markdownIt-Anchor" href="#104-数据库系统故障恢复策略"></a> 10.4 数据库系统故障恢复策略</h2>
<ul>
<li>目的
<ul>
<li>恢复 DB 到一致状态</li>
</ul>
</li>
<li>基本原则
<ul>
<li>冗余（ Redundancy）</li>
</ul>
</li>
<li>实现方法
<ul>
<li>定期转储整个数据库</li>
<li>建立事务日志 (log)</li>
<li>通过备份和日志进行恢复<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201632396.png" alt="" /></li>
</ul>
</li>
</ul>
<h1 id="11-数据库的一致性"><a class="markdownIt-Anchor" href="#11-数据库的一致性"></a> 11 数据库的一致性</h1>
<h2 id="111-基本概念"><a class="markdownIt-Anchor" href="#111-基本概念"></a> 11.1 基本概念</h2>
<p>事务：一个不可分割的操作序列，其中的操作要么都做，要么都不做<br />
一致状态：满足所有完整性约束<br />
一致数据库：数据库处于一致状态</p>
<p>数据库基本命令：</p>
<table>
<thead>
<tr>
<th>DDL</th>
<th>数据定义语言</th>
<th>用于用户创建、修改、删除库和表结构,create/alter/drop</th>
</tr>
</thead>
<tbody>
<tr>
<td>DML</td>
<td>数据操作语言</td>
<td>用于对数据表的增删改，insert/update/delete</td>
</tr>
<tr>
<td>DQL</td>
<td>数据查询语言</td>
<td>用于对数据表的查询,select/from/where/group by/having/order by/limit</td>
</tr>
<tr>
<td>DCL</td>
<td>数据控制语言</td>
<td>用来定义访问权限和安全级别</td>
</tr>
</tbody>
</table>
<p>事务的 ACID 性质：</p>
<ul>
<li>原子性：Atomicity</li>
<li>一致性：Consistency</li>
<li>隔离性：Isolation</li>
<li>持久性：Durability</li>
</ul>
<p>完整性或一致性约束</p>
<ul>
<li>断言数据必须满足</li>
</ul>
<p>例子：<br />
事务的例子：</p>
<ul>
<li>银行转帐： A 帐户转帐到 B 帐户 100 元。该处理包 括了两个更新步骤
<ul>
<li>A=A-100</li>
<li>B=B+100</li>
<li>这两个操作是不可分的：要么都做，要么都不作</li>
</ul>
</li>
</ul>
<h2 id="112-事务的状态"><a class="markdownIt-Anchor" href="#112-事务的状态"></a> 11.2 事务的状态</h2>
<ul>
<li><code>&lt;Start T&gt; </code>
<ul>
<li>Transaction T has started</li>
</ul>
</li>
<li><code>&lt;Commit T&gt; </code>
<ul>
<li>T has finished successfully and all modifications are all reflected to disks</li>
</ul>
</li>
<li><code>&lt;Abort T&gt; </code>
<ul>
<li>T has been terminated and all modifications have been canceled</li>
</ul>
</li>
</ul>
<h2 id="113-事务的原语操作"><a class="markdownIt-Anchor" href="#113-事务的原语操作"></a> 11.3 事务的原语操作</h2>
<ul>
<li>Input (x): disk block with x → memory</li>
<li>Output (x): buffer block with x → disk</li>
<li>Read (x,t): do input(x) if necessary t ← value of x in buffer</li>
<li>Write (x,t): do input(x) if necessary value of x in buffer ← t<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201624391.png" alt="" /></li>
</ul>
<h3 id="1131-事务的例子"><a class="markdownIt-Anchor" href="#1131-事务的例子"></a> 11.3.1 事务的例子</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201624544.png" alt="" /></p>
<h3 id="1132-sql-对事务的支持"><a class="markdownIt-Anchor" href="#1132-sql-对事务的支持"></a> 11.3.2 SQL 对事务的支持</h3>
<ul>
<li>SQL 标准提供了三个语句，允许应用程序声明事务和控制事务</li>
<li>Begin Transaction</li>
<li>Commit Transaction</li>
<li>Rollback Transaction</li>
<li>Oracle
<ul>
<li>Commit 或 Commit Work</li>
<li>Rollback 或 Rollback Work</li>
<li>没有 Begin Transaction 语句，一旦连接数据库建立会话，就认为是一个事务的开始</li>
</ul>
</li>
</ul>
<h3 id="1133-oracle-中的事务设置"><a class="markdownIt-Anchor" href="#1133-oracle-中的事务设置"></a> 11.3.3 Oracle 中的事务设置</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt;set autocommit＝ on</span><br><span class="line">--设置为每次语句执行都自动Commit</span><br><span class="line">SQL&gt;set autocommit=off</span><br><span class="line">SQL&gt;update student set age=age-1;</span><br><span class="line">SQL&gt;rollback; -- 取消前面的更新操作</span><br><span class="line">SQL&gt;update student set age=age-1;</span><br><span class="line">SQL&gt;commit; --提交，修改生效不能再回退</span><br></pre></td></tr></table></figure>
<h1 id="12-并发事务调度"><a class="markdownIt-Anchor" href="#12-并发事务调度"></a> 12 并发事务调度</h1>
<p>调度：</p>
<ul>
<li>多个事务的读写操作按时间排序的执行序列<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201646834.png" alt="" /></li>
<li>调度中每个事务的读写操作保持原来顺序</li>
<li>事务调度时不考虑：
<ul>
<li>数据库的初始状态</li>
<li>事务的语义</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201645323.png" alt="" /></p>
<h2 id="121-冲突可串性"><a class="markdownIt-Anchor" href="#121-冲突可串性"></a> 12.1 冲突可串性</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201656929.png" alt="" /></p>
<h3 id="1211-冲突操作"><a class="markdownIt-Anchor" href="#1211-冲突操作"></a> 12.1.1 冲突操作</h3>
<ul>
<li>如果调度中一对连续操作是冲突的，则意味着如果它们的执行顺序交换，则至少会改变其中一个事务的最终执行结果</li>
<li>如果两个连续操作不冲突，则可以在调度中交换顺序<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201657994.png" alt="" /></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201658779.png" alt="" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201659882.png" alt="" /></p>
<h3 id="1212-冲突可串"><a class="markdownIt-Anchor" href="#1212-冲突可串"></a> 12.1.2 冲突可串</h3>
<ul>
<li>冲突等价 (conflict equivalent )
<ul>
<li>S1, S2 are conflict equivalent schedules if S1 can be transformed into S2 by a series of swaps on non-conflicting actions.</li>
</ul>
</li>
<li>冲突可串性 (conflict serializable)
<ul>
<li>A schedule is conflict serializable if it is conflict equivalent to some serial schedule.<br />
如果一个调度满足冲突可串性，则该调度是可串化调度</li>
</ul>
</li>
</ul>
<h3 id="1213-优先图"><a class="markdownIt-Anchor" href="#1213-优先图"></a> 12.1.3 优先图</h3>
<ul>
<li>优先图用于冲突可串性的判断</li>
<li>优先图结构 - 结点 (Node)：事务 - 有向边 (Arc): Ti → Tj ，满足 <code>Ti &lt;s Tj</code> - 存在 Ti 中的操作 A1 和 Tj 中的操作 A2，满足 - A1 在 A2 前，并且 - A1 和 A2 是冲突操作<br />
优先图与冲突可串性</li>
<li>给定一个调度 S，构造 S 的优先图 P(S)，若 P(S)中无环，则 S 满足冲突可串性<br />
证明：归纳法</li>
</ul>
<h1 id="13-nosql-数据库"><a class="markdownIt-Anchor" href="#13-nosql-数据库"></a> 13 NoSQL 数据库</h1>
<ul>
<li>NoSQL 特点
<ul>
<li>Non relational</li>
<li>Scalability</li>
<li>No pre-defined schema</li>
<li>CAP not ACID</li>
</ul>
</li>
</ul>
<h2 id="131-nosql-兴起的原因"><a class="markdownIt-Anchor" href="#131-nosql-兴起的原因"></a> 13.1 NoSQL 兴起的原因</h2>
<p>（1）RDBMS 无法满足 Web 2.0 的需求</p>
<ul>
<li>无法满足海量数据的管理需求：TB-&gt;PB-&gt;ZB</li>
<li>无法满足数据高并发的需求：1K-&gt;1M-&gt;10M 并发</li>
<li>无法满足高可扩展性和高可用性的需求</li>
</ul>
<p>• <strong>复杂性</strong>： 部署、管理、配置复杂<br />
• <strong>数据库复制</strong>： MySQL 主备之间采用异步复制方式，当主库压力较大时将产生较大延迟，主备切换可能会丢失最后一部分更新事务，往往需要人工介入，备份和恢复不方便<br />
• <strong>扩容问题</strong>： 如果系统压力过大需要增加新的机器，这个过程涉及数据重新划分，整个过程比较复杂且容易出错<br />
• <strong>动态数据迁移问题</strong>： 如果某个数据库组压力过大，需要将其中部分数据迁移出去，迁移过程需要总控节点整体协调，以及数据库节点的配合。这个过程很难做到自动化</p>
<p>NoSQL 兴起的原因：<br />
关系数据库的关键特性包括完善的事务机制和高效的查询机制。这些关键特性在 Web 2.0<br />
时代出现了变化：</p>
<ul>
<li>Web 2.0 网站系统通常不要求严格的数据库事务</li>
<li>Web 2.0 并不要求严格的读写一致性</li>
<li>Web 2.0 通常不包含大量复杂的 SQL 查询（去结构化，存储空间换取更好的查询性能）</li>
</ul>
<table>
<thead>
<tr>
<th>/</th>
<th>RDBMS</th>
<th>NoSQL</th>
</tr>
</thead>
<tbody>
<tr>
<td>优势</td>
<td>以完善的关系代数理论作为基础，有严格的标准，支持事务 ACID，提供严格的数据一致性，借助索引机制可以实现高效的查询,技术成熟，有专业公司的技术支持</td>
<td>可以支持超大规模数据存储，数据分布和复制容易，灵活的数据模型可以很好地支持 Web 2.0 应用，具有强大的横向扩展能力等</td>
</tr>
<tr>
<td>劣势</td>
<td>可扩展性较差，无法较好支持海量数据存储，采用固定的数据库模式，无法较好支持 Web 2.0 应用，事务机制影响系统的整体性能等</td>
<td>缺乏数学理论基础，复杂查询性能不高，大都不能实现事务强一致性，很难实现数据完整性，技术尚不成熟，缺乏专业团队的技术 支持，维护较困难，目前处于百花齐放的状态，用户难以选择（ 120+ 产品 listed in <a target="_blank" rel="noopener" href="http://nosql-database.org">http://nosql-database.org</a> ）等</td>
</tr>
<tr>
<td>应用场景</td>
<td>电信、银行等领域的关键业务系统，需要保证强事务一致性</td>
<td>互联网企业、传统企业的非关键业务（比如数据分析）</td>
</tr>
</tbody>
</table>
<p>NoSQL 的分布技术基本都是分布式系统中的技术，跟数据库系统关系不大</p>
<h2 id="132-cap"><a class="markdownIt-Anchor" href="#132-cap"></a> 13.2 CAP</h2>
<ul>
<li>C（ Consistency）：一致性—— all nodes see the same data at the<br />
same time 是指任何一个读操作总是能够读到之前完成的写操作的结果，也就是在分布式环境中，多点的数据是一致的，或者说， 所有节点在同一时间具有相同的数据</li>
<li>A:（ Availability）：可用性——reads and writes always succeed 是指快速获取数据，可以在确定的时间内返回操作结果，保证每个请求不管成 功或者失败都有响应</li>
<li>P（ Tolerance of Network Partition）：分区容忍性——the system continues to operate despite arbitrary message loss or failure of part of the system 是指当出现网络分区的情况时（即系统中的一部分节点无法和其他节点进行通信），分离的系统也能够正常运行，也就是说，系统中任意信息的丢失或失败不会影响系统的继续运作。</li>
</ul>
<h2 id="133-base"><a class="markdownIt-Anchor" href="#133-base"></a> 13.3 BASE</h2>
<ul>
<li>Basically Available<br />
基本可用，是指一个分布式系统的一部分发生问题变得不可用时，其他部分仍然可以正常使用。也即允许损失部分可用性。</li>
<li>Soft-state<br />
“软状态（ Soft-state）”是与“硬状态（ Hardstate）”相对应的一种提法。数据库保存的数据是“硬状态”时，可以保证数据一致性，即保证数据一直是正确的。“软状态”是指状态可以有一段时间不同步，具有一定的滞后性</li>
<li>Eventual consistency<br />
一致性的类型包括强一致性和弱一致性。对于强一致性而言，当执行完一次更新操作后，后续的其他读操作就可以保证读到更新后的最新数据。如果不能保证后续访问读到 的都是更新后的最新数据，那么就是弱一致性。最终一致性是弱一致性的一种特例，允许后续的访问操作可以暂时读不到更新后的数据，但是经过一段时间之后，必须最终读到更新后的数据。最常见的实现最终一致性的系统是 DNS（域名系统）。一个域名更新操作根据配置的形式被分发出去，并结合有过期机制的缓存；最终所有的客户端可以看到最新的值。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201722430.png" alt="" /></p>
<h2 id="134-存储引擎"><a class="markdownIt-Anchor" href="#134-存储引擎"></a> 13.4 存储引擎</h2>
<p>LSM-tree 是目前许多 NoSQL 数据库系统的存储引擎</p>
<ul>
<li>B±tree
<ul>
<li>有序、平衡的多级存储结构</li>
<li>面向磁盘设计，节点都是磁盘块</li>
<li>查找性能好，适合读密集的负载</li>
</ul>
</li>
<li>B±tree 的问题
<ul>
<li>原位更新（ In-Place Update）</li>
<li>写代价高，写性能差
<ul>
<li>对叶节点的写基本都是随机写</li>
<li>级联分裂、合并等 SMO 操作带来大量的随机写</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>如何避免 B±tree 随机写？</p>
<ul>
<li>
<p>采用 log-structured 的 Append-only 写</p>
</li>
<li>
<p>Log-structured update</p>
<ul>
<li>类似事务日志的写策略</li>
<li>日志项不允许修改，只能 Append</li>
</ul>
</li>
<li>
<p>写日志一般可视作顺序写，写性能高</p>
</li>
<li>
<p>但是直接把 B-tree 的节点改成 Log structured 的 Append-Only 不能解决随机写的问题</p>
<ul>
<li>叶节点需要有序</li>
<li>把新的键值 Append 到叶节点最后不行</li>
<li>不同节点的更新依然是随机写</li>
</ul>
</li>
<li>
<p>另一种思路：把所有叶节点的更新合并起来一起顺序写<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201950775.png" alt="" /></p>
</li>
<li>
<p>B-tree: 写慢读快</p>
</li>
<li>
<p>Logging：写快读慢</p>
</li>
<li>
<p>LSM-tree：先保证写快，同时读也较快<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201951679.png" alt="" /></p>
</li>
</ul>
<h3 id="1341-lsm-tree-的设计思路"><a class="markdownIt-Anchor" href="#1341-lsm-tree-的设计思路"></a> 13.4.1 LSM-tree 的设计思路</h3>
<ul>
<li>LSM (Log-Structured Merge) Tree
<ul>
<li>同时结合内存结构和磁盘结构（ page-based）
<ul>
<li>数据先写到内存结构，然后再写入磁盘</li>
</ul>
</li>
<li>Log-Structured
<ul>
<li>采用 Append 方式顺序写磁盘数据</li>
</ul>
</li>
<li>Merge Write
<ul>
<li>内存数据批量合并写入磁盘</li>
<li>将多个小的随机写转换为顺序写</li>
</ul>
</li>
<li>数据分层写入磁盘
<ul>
<li>避免一次批量写的数据量过大：内存压力过大、批量写时 IO 太多</li>
</ul>
</li>
<li>每一层的数据均有序(除了第 0 层)</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201953773.png" alt="" /></p>
<ul>
<li>写数据的过程
<ul>
<li>直接写入 WAL 和 Memtable 即返回，很快</li>
<li>数据落盘： Flush &amp; Compaction</li>
</ul>
</li>
<li>读数据的过程
<ul>
<li>先查 DRAM 结构，依次下沉查磁盘</li>
<li>现有的一些读优化： Skiplist、 Block Cache、 Index Block、 Bloom Filter</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201954422.png" alt="" /></p>
<p>Compaction 操作：</p>
<ul>
<li>Minor Compaction（Flush）
<ul>
<li>Immutable MemTable —&gt; SSTable (L0)</li>
<li>L0 中的每个 SSTable 内部有序，但 SSTable 之间可能会存在重复的 key，key 的范围也可能 overlap</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201955081.png" alt="" /></p>
<h3 id="1342-lsm-tree-的总结"><a class="markdownIt-Anchor" href="#1342-lsm-tree-的总结"></a> 13.4.2 LSM-tree 的总结</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201957465.png" alt="" /></p>
<h3 id="1343-优化工作"><a class="markdownIt-Anchor" href="#1343-优化工作"></a> 13.4.3 优化工作</h3>
<ul>
<li>
<p>SILK （ ATC 2019, Best Paper）</p>
<ul>
<li>针对周期性有峰值的负载，高负载时延迟下层合并但继续上层合并，低负载时再执行下层合并<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201958164.png" alt="" /></li>
</ul>
</li>
<li>
<p>FPGA-Accelerated Compaction (FAST’20) - 理论上有助于平滑 LSM-tree 性能的抖动 - 需要专用的 FGPA 及驱动支持<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302201959773.png" alt="" /></p>
</li>
<li>
<p>Offload Compaction (VLDB’15)</p>
<ul>
<li>借助独立的 Compaction Server 来完成合并，从而不消耗本地 Server 的 IO 和 CPU 资源</li>
</ul>
</li>
</ul>
<h2 id="135-hbase-和-hdfs-和-zookeeper"><a class="markdownIt-Anchor" href="#135-hbase-和-hdfs-和-zookeeper"></a> 13.5 HBase 和 HDFS 和 Zookeeper</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202001395.png" alt="" /><br />
HDFS 缺点是：</p>
<ul>
<li>不支持小文件</li>
<li>不支持并发写</li>
<li>不支持文件随即修改</li>
<li>查询效率低</li>
</ul>
<p>HBase 是一个构建在 HDFS 上的分布式数据库</p>
<ul>
<li>是一个支持百万级别高并发写入</li>
<li>支持实时查询</li>
<li>适合存储稀疏数据的分布式数据库系统</li>
</ul>
<p>Zookeeper 是一个开源的<strong>分布式协调服务</strong>，由雅虎创建，是 Google Chubby 的开源实现</p>
<ul>
<li>分布式应用程序可以基于 ZooKeeper 实现诸如数据发布/订阅、负载均衡、命名服务、分布式协调/通知、集群管理、Master 选举、分布式锁和分布式队列等功能</li>
<li>相当于一个管理员身份，加强了集群的稳定性</li>
</ul>
<h3 id="1351-hbase-简介"><a class="markdownIt-Anchor" href="#1351-hbase-简介"></a> 13.5.1 HBase 简介</h3>
<p>HBase： Hadoop dataBase</p>
<ul>
<li>起源于 Google Bigtable</li>
<li>Column Store，同时也使用了 Key/Value 存储</li>
<li>分布式数据库，支持海量数据存储</li>
<li>设计目标
<ul>
<li>海量数据存储（ PB 级别）</li>
<li>高并发操作</li>
<li>数据随机读写操作</li>
<li>数据强一致性</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202010655.png" alt="" /><br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202010020.png" alt="" /></p>
<table>
<thead>
<tr>
<th>/</th>
<th>HBase</th>
<th>RDBMS</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据类型</td>
<td>HBase 只有简单的字符类型，所有的类型都是交由用户自己处理，它只保存字符串</td>
<td>关系数据库有丰富的类型和存储方式</td>
</tr>
<tr>
<td>数据操作</td>
<td>HBase 只有很简单的插入、查询、删除、清空等操作，表和表之间是分离的，没有复杂的表和表之间的关系</td>
<td>通常有各式各样的函数和连接操作</td>
</tr>
<tr>
<td>可伸缩性</td>
<td>HBase 能够轻松增加或减少硬件的数量，并且容错性较高</td>
<td>通常需要增加中间层才能实现类似的功能</td>
</tr>
</tbody>
</table>
<h3 id="1352-hbase-数据类型"><a class="markdownIt-Anchor" href="#1352-hbase-数据类型"></a> 13.5.2 HBase 数据类型</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202013703.png" alt="" /></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202014930.png" alt="" /></p>
<p>列存储的优点：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202014101.png" alt="" /></p>
<table>
<thead>
<tr>
<th>表（ Table）</th>
<th>HBase 采用表来组织数据，表由行和列组成，列划分为若干个列族</th>
</tr>
</thead>
<tbody>
<tr>
<td>行（ Row）</td>
<td>每个 HBase 表都由若干行组成，每个行由行键（ row key）来标识</td>
</tr>
<tr>
<td>列族（ Column Family）</td>
<td>一个 HBase 表被分组成许多“列族”（ Column Family）的集合，每个列族有动态的列集合</td>
</tr>
<tr>
<td>列限定符（ Column Qualifier）</td>
<td>列族里的数据通过列限定符来定位</td>
</tr>
<tr>
<td>单元格（ Cell）</td>
<td>在 HBase 表中，通过行、列族和列限定符确定一个“单元格”（ cell），单元格中存储的数据没有据类型，都是字节流</td>
</tr>
<tr>
<td>时间戳（ Version）</td>
<td>每个单元格都保存着同一份数据的多个版本，这些版本采用时间戳进行索引</td>
</tr>
</tbody>
</table>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202017598.png" alt="" /></p>
<p>HBase 中需要根据行键、列族、列限定符和时间戳来确定一个单元格</p>
<p>因此，可以视为一个“四维坐标”，即:<code> [行键, 列族, 列限定符, 时间戳]</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202018931.png" alt="" /></p>
<h3 id="1353-table-的物理存储结构"><a class="markdownIt-Anchor" href="#1353-table-的物理存储结构"></a> 13.5.3 Table 的物理存储结构</h3>
<ul>
<li>Table 的每个列族存储在单独的文件中</li>
<li>Row Key &amp; Version numbers 在每个列族中复制</li>
<li>空 cell 不存储<br />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202019605.png" alt="" /></li>
</ul>
<p>Table 和 Region：</p>
<ul>
<li>Table 和 Region</li>
<li>Table 中所有行按 Row Key 排序</li>
<li>单个 Table 一开始只有一个 Region</li>
<li>随着记录越来越多，单个 Region 太大，达到阈值，分裂成 2 个 Region</li>
<li>Region 是 HBase 中分布式存储分配的最小单元</li>
<li>不同 Region 分布在不同的 Region Server 上</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202021584.png" alt="" /></p>
<ul>
<li>Region
<ul>
<li>Table 划分为 Region 的集合</li>
<li>Region 是 HBase 中分布式存储分配的最小单元</li>
<li>每个 Region 默认大小是 100MB 到 200MB（ 2006 年以前的硬件配置）</li>
<li>每个 Region 的最佳大小取决于单台服务器的有效处理能力</li>
<li>目前每个 Region 最佳大小建议 1GB-2GB（ 2013 年以后的硬件配置）</li>
<li>每个 Region Server 存储 10-1000 个 Region</li>
</ul>
</li>
<li>Store
<ul>
<li>每个 Region 虽然是分布式存储分配的最小单元，但不是存储最小单元</li>
<li>Region 由多个 Store 组成，每个 Store 保存一个 Column Family</li>
<li>每个 Store 由 1 个 MemStore 和 0 到多个 StoreFile 组成
<ul>
<li>MemStore 存储在内存中</li>
<li>StoreFile 存储在 HDFS 上，底层称为 HFile</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="1354-数据读写过程"><a class="markdownIt-Anchor" href="#1354-数据读写过程"></a> 13.5.4 数据读写过程</h3>
<ul>
<li>用户写入数据时，被分配到相应 Region Server 去执行</li>
<li>用户数据首先被写入到 MemStore 和 HLog 中</li>
<li>只有当操作写入 HLog 之后， commit()调用才会将其返回给客户端
<ul>
<li>HLog 是一个实现 WAL 的类，每次写 MemStore 前写入 HLog</li>
<li>每个 Region Server 维护一个 HLog</li>
<li>HLog 定期删除旧的文件（已经持久化到 HFile 的数据）</li>
</ul>
</li>
<li>当用户读取数据时， Region Server 会首先访问 MemStore 缓存，如果找不到，再去磁盘上面的 StoreFile 中寻找</li>
</ul>
<h3 id="1355-hbase-访问接口"><a class="markdownIt-Anchor" href="#1355-hbase-访问接口"></a> 13.5.5 HBase 访问接口</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202023639.png" alt="" /></p>
<h2 id="136-mongodb"><a class="markdownIt-Anchor" href="#136-mongodb"></a> 13.6 MongoDB</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202302202024596.png" alt="" /></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://neuralife.cn">Rongkang Xiong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://neuralife.cn/posts/%E8%AF%BE%E7%A8%8B%E5%A4%8D%E4%B9%A0/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F-%E5%A4%8D%E4%B9%A0%E7%9F%A5%E8%AF%86%E7%82%B9">https://neuralife.cn/posts/%E8%AF%BE%E7%A8%8B%E5%A4%8D%E4%B9%A0/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F-%E5%A4%8D%E4%B9%A0%E7%9F%A5%E8%AF%86%E7%82%B9</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://neuralife.cn" target="_blank">爱养虫的小熊</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/">个人博客</a><a class="post-meta__tags" href="/tags/%E8%AF%BE%E7%A8%8B%E5%A4%8D%E4%B9%A0/">课程复习</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121646653.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/website/wechatpay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/website/wechatpay.png" alt="Wechat"/></a><div class="post-qr-code-desc">Wechat</div></li><li class="reward-item"><a href="/images/website/alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/website/alipay.png" alt="Alipay"/></a><div class="post-qr-code-desc">Alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/obsidian-hexo" title="Obsidian+Hexo"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121645978.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Obsidian+Hexo</div></div></a></div><div class="next-post pull-right"><a href="/posts/%E7%94%B5%E5%AD%90%E6%95%B0%E7%A0%81/%E5%B0%8F%E7%B1%B3ax6s%E5%88%B7openwrt%E6%95%99%E7%A8%8B" title="小米AX6S刷OpenWrt教程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/20220406131803.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">小米AX6S刷OpenWrt教程</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/%E5%8D%9A%E5%AE%A2/%E5%85%A5%E7%AB%99%E4%BB%8B%E7%BB%8D" title="入站介绍"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121647509.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-10</div><div class="title">入站介绍</div></div></a></div><div><a href="/posts/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%87%8D%E5%BB%BA%E7%B3%BB%E5%88%971-%E5%8D%9A%E5%AE%A2%E5%BB%BA%E7%AB%8B%E5%87%86%E5%A4%87" title="个人博客重建系列1:博客建立准备"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121702403.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-30</div><div class="title">个人博客重建系列1:博客建立准备</div></div></a></div><div><a href="/posts/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%87%8D%E5%BB%BA%E7%B3%BB%E5%88%972%EF%BC%9Agithub%E6%90%AD%E5%BB%BAhexo%E5%8D%9A%E5%AE%A2%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E6%8E%A8%E9%80%81%E5%88%B0%E5%8F%A6%E4%B8%80%E4%B8%AA%E4%BB%93%E5%BA%93%E5%92%8Cgitee%E4%BB%93%E5%BA%93" title="个人博客重建系列2：github搭建hexo博客自动构建推送到另一个仓库和gitee仓库"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121646590.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-01</div><div class="title">个人博客重建系列2：github搭建hexo博客自动构建推送到另一个仓库和gitee仓库</div></div></a></div><div><a href="/posts/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%87%8D%E5%BB%BA%E7%B3%BB%E5%88%973%EF%BC%9Abutterfly%E4%B8%BB%E9%A2%98%E5%AE%89%E8%A3%85" title="个人博客重建系列3：Butterfly主题安装"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/image-20211208172457161.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-08</div><div class="title">个人博客重建系列3：Butterfly主题安装</div></div></a></div><div><a href="/posts/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%87%8D%E5%BB%BA%E7%B3%BB%E5%88%974%EF%BC%9A%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0front%E8%AE%BE%E7%BD%AE" title="个人博客重建系列4：博客文章Front设置"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121646590.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-08</div><div class="title">个人博客重建系列4：博客文章Front设置</div></div></a></div><div><a href="/posts/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%87%8D%E5%BB%BA%E7%B3%BB%E5%88%975%EF%BC%9Abutterfly%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE" title="个人博客重建系列5：Butterfly主题配置"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121646590.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-08</div><div class="title">个人博客重建系列5：Butterfly主题配置</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Rongkang Xiong</div><div class="author-info__description">一个常来逛逛的地方 | 爱养虫的小熊</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/RongkangXiong"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/RongkangXiong" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:earth@mail.ustc.edu.cn" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">人生就像一杯茶，不会苦一辈子，但总会苦一阵子</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text"> 1 数据库系统概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text"> 1.1 数据库系统基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#111-%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.1.</span> <span class="toc-text"> 1.1.1 数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#112-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.2.</span> <span class="toc-text"> 1.1.2 数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#113-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%BC%8Fschema"><span class="toc-number">1.1.3.</span> <span class="toc-text"> 1.1.3 数据库模式(Schema)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#114-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.4.</span> <span class="toc-text"> 1.1.4 数据库管理系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#115-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.5.</span> <span class="toc-text"> 1.1.5 数据库系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#116-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E4%B8%89%E4%B8%AA%E4%B8%BB%E8%A6%81%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.6.</span> <span class="toc-text"> 1.1.6 数据库系统中的三个主要问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-dbms-%E5%AE%9E%E7%8E%B0%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text"> 1.2 DBMS 实现问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#121-%E4%B8%80%E4%B8%AA%E8%99%9A%E6%8B%9F%E7%9A%84-dbmsmegatron2000"><span class="toc-number">1.2.1.</span> <span class="toc-text"> 1.2.1 一个虚拟的 DBMS：Megatron2000</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#122-megatron-2000-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text"> 1.2.2 Megatron 2000 使用示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#123-megatron-2000-%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.3.</span> <span class="toc-text"> 1.2.3 Megatron 2000 如何执行查询？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#124-megatron-2000-%E5%AD%98%E5%9C%A8%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.4.</span> <span class="toc-text"> 1.2.4 Megatron 2000 存在什么问题？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1241-%E5%85%83%E7%BB%84%E5%B9%B3%E9%93%BA%E5%9C%A8%E7%A3%81%E7%9B%98%E4%B8%8A"><span class="toc-number">1.2.4.1.</span> <span class="toc-text"> 1.2.4.1 元组平铺在磁盘上</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1242-%E4%BD%8E%E7%BA%A7%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%A4%84%E7%90%86"><span class="toc-number">1.2.4.2.</span> <span class="toc-text"> 1.2.4.2 低级的查询处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1243-%E6%B2%A1%E6%9C%89%E7%BC%93%E5%86%B2%E5%8C%BA%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.4.3.</span> <span class="toc-text"> 1.2.4.3 没有缓冲区管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1244-%E6%B2%A1%E6%9C%89%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="toc-number">1.2.4.4.</span> <span class="toc-text"> 1.2.4.4 没有并发控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1245-%E6%B2%A1%E6%9C%89%E7%B4%A2%E5%BC%95%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E6%95%88%E7%8E%87%E4%BD%8E"><span class="toc-number">1.2.4.5.</span> <span class="toc-text"> 1.2.4.5 没有索引；数据查询效率低</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1246-%E6%B2%A1%E6%9C%89%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="toc-number">1.2.4.6.</span> <span class="toc-text"> 1.2.4.6 没有可靠性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1247-%E6%B2%A1%E6%9C%89%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%BC%96%E7%A8%8B%E6%8E%A5%E5%8F%A3-api"><span class="toc-number">1.2.4.7.</span> <span class="toc-text"> 1.2.4.7 没有应用程序编程接口（ API）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1248-%E7%B3%9F%E7%B3%95%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8%E7%BB%84%E7%BB%87"><span class="toc-number">1.2.4.8.</span> <span class="toc-text"> 1.2.4.8 糟糕的数据字典组织</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E9%97%AE%E9%A2%98"><span class="toc-number">1.3.</span> <span class="toc-text"> 1.3 数据库设计问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.</span> <span class="toc-text"> 1.4 方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#141-%E6%A8%A1%E5%BC%8F%E5%88%86%E8%A7%A3"><span class="toc-number">1.4.1.</span> <span class="toc-text"> 1.4.1 模式分解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%98%E5%8F%96%E9%97%AE%E9%A2%98"><span class="toc-number">1.5.</span> <span class="toc-text"> 1.5 数据库存取问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1501-sql-%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">1.5.0.1.</span> <span class="toc-text"> 1.5.0.1 SQL 基本组成</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9F%A5%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text"> 2 关系型数据库知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.</span> <span class="toc-text"> 2.1 数据库体系结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#211-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">2.1.1.</span> <span class="toc-text"> 2.1.1 数据库模式的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2111-%E6%A8%A1%E5%BC%8F%E5%92%8C%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.1.1.1.</span> <span class="toc-text"> 2.1.1.1 模式和实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2112-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B8%89%E7%BA%A7%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.1.2.</span> <span class="toc-text"> 2.1.1.2 数据库的三级模式结构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#21121-%E5%A4%96%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.1.2.1.</span> <span class="toc-text"> 2.1.1.2.1 外模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#21122-%E6%A6%82%E5%BF%B5%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.1.2.2.</span> <span class="toc-text"> 2.1.1.2.2 概念模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#21123-%E5%86%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.1.2.3.</span> <span class="toc-text"> 2.1.1.2.3 内模式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2113-%E4%BA%8C%E7%BA%A7%E6%98%A0%E5%83%8F%E5%92%8C%E6%95%B0%E6%8D%AE%E7%8B%AC%E7%AB%8B%E6%80%A7"><span class="toc-number">2.1.1.3.</span> <span class="toc-text"> 2.1.1.3 二级映像和数据独立性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#21131-%E5%A4%96%E6%A8%A1%E5%BC%8F%E6%A8%A1%E5%BC%8F%E6%98%A0%E8%B1%A1"><span class="toc-number">2.1.1.3.1.</span> <span class="toc-text"> 2.1.1.3.1 外模式&#x2F;模式映象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#21132-%E6%A8%A1%E5%BC%8F%E5%86%85%E6%A8%A1%E5%BC%8F%E6%98%A0%E8%B1%A1"><span class="toc-number">2.1.1.3.2.</span> <span class="toc-text"> 2.1.1.3.2 模式&#x2F;内模式映象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#21133-%E4%B8%BE%E4%BE%8B"><span class="toc-number">2.1.1.3.3.</span> <span class="toc-text"> 2.1.1.3.3 举例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2114-sql-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.1.4.</span> <span class="toc-text"> 2.1.1.4 SQL 数据库体系结构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text"> 2.2 关系数据模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#221-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">2.2.1.</span> <span class="toc-text"> 2.2.1 数据模型的分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-sql"><span class="toc-number">2.3.</span> <span class="toc-text"> 2.3 SQL</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="toc-number">3.</span> <span class="toc-text"> 3 数据存储</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#31-%E5%AD%98%E5%82%A8%E5%99%A8%E7%BB%93%E6%9E%84"><span class="toc-number">3.1.</span> <span class="toc-text"> 3.1 存储器结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#311-%E9%97%AA%E5%AD%98nand"><span class="toc-number">3.1.1.</span> <span class="toc-text"> 3.1.1 闪存：NAND</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3111-%E9%97%AA%E5%AD%98%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9D%A2%E4%B8%B4%E7%9A%84%E6%96%B0%E6%8C%91%E6%88%98"><span class="toc-number">3.1.1.1.</span> <span class="toc-text"> 3.1.1.1 闪存数据库面临的新挑战</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#312-%E7%9B%B8%E5%8F%98%E5%AD%98%E5%82%A8%E5%99%A8pcm"><span class="toc-number">3.1.2.</span> <span class="toc-text"> 3.1.2 相变存储器：PCM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#313-%E7%A3%81%E7%9B%98"><span class="toc-number">3.1.3.</span> <span class="toc-text"> 3.1.3 磁盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#314-%E7%A3%81%E7%9B%98%E5%AD%98%E5%8F%96%E6%97%B6%E9%97%B4"><span class="toc-number">3.1.4.</span> <span class="toc-text"> 3.1.4 磁盘存取时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#315-%E5%86%99%E5%9D%97"><span class="toc-number">3.1.5.</span> <span class="toc-text"> 3.1.5 写块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#316-%E5%9D%97%E4%BF%AE%E6%94%B9"><span class="toc-number">3.1.6.</span> <span class="toc-text"> 3.1.6 块修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#317-megatron747-%E7%A3%81%E7%9B%98"><span class="toc-number">3.1.7.</span> <span class="toc-text"> 3.1.7 Megatron747 磁盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#318-%E7%A3%81%E7%9B%98%E5%AD%98%E5%8F%96%E4%BC%98%E5%8C%96"><span class="toc-number">3.1.8.</span> <span class="toc-text"> 3.1.8 磁盘存取优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3181-random-io-to-sequential-io"><span class="toc-number">3.1.8.1.</span> <span class="toc-text"> 3.1.8.1 Random IO to Sequential IO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3182-%E9%A2%84%E5%8F%96%E7%BC%93%E5%86%B2"><span class="toc-number">3.1.8.2.</span> <span class="toc-text"> 3.1.8.2 预取&#x2F;缓冲</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3183-%E5%9D%97%E5%A4%A7%E5%B0%8F%E9%80%89%E6%8B%A9"><span class="toc-number">3.1.8.3.</span> <span class="toc-text"> 3.1.8.3 块大小选择</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#319-%E6%96%B0%E5%9E%8B%E5%AD%98%E5%82%A8"><span class="toc-number">3.1.9.</span> <span class="toc-text"> 3.1.9 新型存储</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3191-%E6%96%B0%E5%9E%8B%E5%AD%98%E5%82%A8%E8%AE%A1%E7%AE%97%E6%9E%B6%E6%9E%84"><span class="toc-number">3.1.9.1.</span> <span class="toc-text"> 3.1.9.1 新型存储计算架构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32-%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%A4%BA"><span class="toc-number">3.2.</span> <span class="toc-text"> 3.2 数据表示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#321-%E6%95%B0%E6%8D%AE%E5%85%83%E7%B4%A0%E7%9A%84%E8%A1%A8%E7%A4%BA%E5%B1%82%E6%AC%A1"><span class="toc-number">3.2.1.</span> <span class="toc-text"> 3.2.1 数据元素的表示层次</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#322-%E6%95%B0%E6%8D%AE%E9%A1%B9%E8%A1%A8%E7%A4%BA%E5%86%85%E5%AE%B9"><span class="toc-number">3.2.2.</span> <span class="toc-text"> 3.2.2 数据项表示内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#323-%E6%95%B0%E6%8D%AE%E9%A1%B9%E8%A1%A8%E7%A4%BA%E6%96%B9%E6%B3%95sql-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.3.</span> <span class="toc-text"> 3.2.3 数据项表示方法：SQL 数据类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#33-%E8%AE%B0%E5%BD%95%E7%9A%84%E7%BB%84%E7%BB%87"><span class="toc-number">3.3.</span> <span class="toc-text"> 3.3 记录的组织</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#331-%E5%9B%BA%E5%AE%9A%E6%A0%BC%E5%BC%8F%E5%AE%9A%E9%95%BF%E8%AE%B0%E5%BD%95"><span class="toc-number">3.3.1.</span> <span class="toc-text"> 3.3.1 固定格式定长记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#332-%E5%8F%AF%E5%8F%98%E6%A0%BC%E5%BC%8F%E8%AE%B0%E5%BD%95"><span class="toc-number">3.3.2.</span> <span class="toc-text"> 3.3.2 可变格式记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#333-%E5%8F%98%E9%95%BF%E8%AE%B0%E5%BD%95%E8%A1%A8%E7%A4%BA"><span class="toc-number">3.3.3.</span> <span class="toc-text"> 3.3.3 变长记录表示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#34-%E8%AE%B0%E5%BD%95%E5%9C%A8%E5%9D%97%E4%B8%AD%E7%9A%84%E7%BB%84%E7%BB%87"><span class="toc-number">3.4.</span> <span class="toc-text"> 3.4 记录在块中的组织</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#341-%E5%AE%9A%E9%95%BF%E8%AE%B0%E5%BD%95%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%9D%97%E5%86%85%E7%BB%84%E7%BB%87"><span class="toc-number">3.4.1.</span> <span class="toc-text"> 3.4.1 定长记录的两种块内组织</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#342-%E5%8F%98%E9%95%BF%E8%AE%B0%E5%BD%95%E5%9C%A8%E5%9D%97%E5%86%85%E7%9A%84%E7%BB%84%E7%BB%87"><span class="toc-number">3.4.2.</span> <span class="toc-text"> 3.4.2 变长记录在块内的组织</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#343-%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98"><span class="toc-number">3.4.3.</span> <span class="toc-text"> 3.4.3 其他问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3431-%E8%AE%B0%E5%BD%95%E5%9C%A8%E5%9D%97%E4%B8%AD%E7%9A%84%E5%88%86%E9%9A%94-separating-records"><span class="toc-number">3.4.3.1.</span> <span class="toc-text"> 3.4.3.1 记录在块中的分隔 (separating records)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3432-%E8%AE%B0%E5%BD%95%E8%B7%A8%E5%9D%97-vs%E8%AE%B0%E5%BD%95%E4%B8%8D%E8%B7%A8%E5%9D%97"><span class="toc-number">3.4.3.2.</span> <span class="toc-text"> 3.4.3.2 记录跨块 vs.记录不跨块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3433-%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%AE%B0%E5%BD%95%E8%81%9A%E7%B0%87"><span class="toc-number">3.4.3.3.</span> <span class="toc-text"> 3.4.3.3 不同类型的记录聚簇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3434-%E6%8C%89%E5%BA%8F%E7%BB%84%E7%BB%87-sequencing"><span class="toc-number">3.4.3.4.</span> <span class="toc-text"> 3.4.3.4 按序组织 (sequencing)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3435-%E8%AE%B0%E5%BD%95%E7%9A%84%E5%88%86%E8%A3%82-split-records"><span class="toc-number">3.4.3.5.</span> <span class="toc-text"> 3.4.3.5 记录的分裂 (split records)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3436-%E8%AE%B0%E5%BD%95%E5%9C%B0%E5%9D%80-record-address"><span class="toc-number">3.4.3.6.</span> <span class="toc-text"> 3.4.3.6 记录地址 (record address)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3437-%E8%AE%B0%E5%BD%95%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="toc-number">3.4.3.7.</span> <span class="toc-text"> 3.4.3.7 记录的修改</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%A4%BA"><span class="toc-number">4.</span> <span class="toc-text"> 4 数据表示</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E7%BC%93%E5%86%B2%E5%8C%BA%E7%AE%A1%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text"> 5 缓冲区管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#51-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">5.1.</span> <span class="toc-text"> 5.1 基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#52-%E7%BC%93%E5%86%B2%E5%8C%BA%E7%BB%93%E6%9E%84"><span class="toc-number">5.2.</span> <span class="toc-text"> 5.2 缓冲区结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#521-frame-%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">5.2.1.</span> <span class="toc-text"> 5.2.1 frame 的参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#53-%E7%BC%93%E5%86%B2%E5%8C%BA%E6%9B%BF%E6%8D%A2%E7%AD%96%E7%95%A5"><span class="toc-number">5.3.</span> <span class="toc-text"> 5.3 缓冲区替换策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#54-%E7%BC%93%E5%86%B2%E5%8C%BA%E7%AE%A1%E7%90%86%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.4.</span> <span class="toc-text"> 5.4 缓冲区管理器的实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="toc-number">6.</span> <span class="toc-text"> 6 索引结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#61-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">6.1.</span> <span class="toc-text"> 6.1 基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#62-%E9%A1%BA%E5%BA%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="toc-number">6.2.</span> <span class="toc-text"> 6.2 顺序文件上的索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#621-%E5%AF%86%E9%9B%86%E7%B4%A2%E5%BC%95"><span class="toc-number">6.2.1.</span> <span class="toc-text"> 6.2.1 密集索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#622-%E7%A8%80%E7%96%8F%E7%B4%A2%E5%BC%95sparse-index"><span class="toc-number">6.2.2.</span> <span class="toc-text"> 6.2.2 稀疏索引(Sparse Index)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#623-%E5%A4%9A%E7%BA%A7%E7%B4%A2%E5%BC%95"><span class="toc-number">6.2.3.</span> <span class="toc-text"> 6.2.3 多级索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#63-%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95"><span class="toc-number">6.3.</span> <span class="toc-text"> 6.3 辅助索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#64-%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95inverted-index"><span class="toc-number">6.4.</span> <span class="toc-text"> 6.4 倒排索引(Inverted Index)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#65-b%E6%A0%91"><span class="toc-number">6.5.</span> <span class="toc-text"> 6.5 B+树</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#651-%E5%8F%B6%E8%8A%82%E7%82%B9"><span class="toc-number">6.5.1.</span> <span class="toc-text"> 6.5.1 叶节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#652-%E4%B8%AD%E9%97%B4%E8%8A%82%E7%82%B9"><span class="toc-number">6.5.2.</span> <span class="toc-text"> 6.5.2 中间节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#653-b%E6%A0%91%E6%9F%A5%E6%89%BE"><span class="toc-number">6.5.3.</span> <span class="toc-text"> 6.5.3 B+树查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#654-b%E6%A0%91%E6%8F%92%E5%85%A5"><span class="toc-number">6.5.4.</span> <span class="toc-text"> 6.5.4 B+树插入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#655-b%E6%A0%91%E5%88%A0%E9%99%A4"><span class="toc-number">6.5.5.</span> <span class="toc-text"> 6.5.5 B+树删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#656-b%E6%A0%91%E7%9A%84%E6%95%88%E7%8E%87"><span class="toc-number">6.5.6.</span> <span class="toc-text"> 6.5.6 B+树的效率</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#66-%E6%95%A3%E5%88%97%E8%A1%A8hash-table"><span class="toc-number">6.6.</span> <span class="toc-text"> 6.6 散列表(Hash Table)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#661-%E6%95%A3%E5%88%97%E8%A1%A8%E6%9F%A5%E6%89%BE"><span class="toc-number">6.6.1.</span> <span class="toc-text"> 6.6.1 散列表查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#662-%E6%95%A3%E5%88%97%E8%A1%A8%E7%9A%84%E6%8F%92%E5%85%A5"><span class="toc-number">6.6.2.</span> <span class="toc-text"> 6.6.2 散列表的插入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#663-%E6%95%A3%E5%88%97%E8%A1%A8%E7%9A%84%E5%88%A0%E9%99%A4"><span class="toc-number">6.6.3.</span> <span class="toc-text"> 6.6.3 散列表的删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#664-%E6%95%A3%E5%88%97%E8%A1%A8%E7%A9%BA%E9%97%B4%E5%88%A9%E7%94%A8%E7%8E%87"><span class="toc-number">6.6.4.</span> <span class="toc-text"> 6.6.4 散列表空间利用率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#665-%E5%8F%AF%E6%89%A9%E5%B1%95%E6%95%A3%E5%88%97%E8%A1%A8"><span class="toc-number">6.6.5.</span> <span class="toc-text"> 6.6.5 可扩展散列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#666-%E7%BA%BF%E6%80%A7%E6%95%A3%E5%88%97%E8%A1%A8"><span class="toc-number">6.6.6.</span> <span class="toc-text"> 6.6.6 线性散列表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">7.</span> <span class="toc-text"> 7 查询优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#71-%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90parsing"><span class="toc-number">7.1.</span> <span class="toc-text"> 7.1 语法分析(Parsing)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#72-%E9%80%BB%E8%BE%91%E6%9F%A5%E8%AF%A2%E8%AE%A1%E5%88%92%E7%94%9F%E6%88%90"><span class="toc-number">7.2.</span> <span class="toc-text"> 7.2 逻辑查询计划生成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#721-%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0%E7%AC%A6%E5%8F%B7"><span class="toc-number">7.2.1.</span> <span class="toc-text"> 7.2.1 关系代数符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#722-%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0%E4%B8%8E-sql"><span class="toc-number">7.2.2.</span> <span class="toc-text"> 7.2.2 关系代数与 SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#723-%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E6%A0%91"><span class="toc-number">7.2.3.</span> <span class="toc-text"> 7.2.3 语法分析树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#724-%E9%80%BB%E8%BE%91%E6%9F%A5%E8%AF%A2%E8%AE%A1%E5%88%92"><span class="toc-number">7.2.4.</span> <span class="toc-text"> 7.2.4 逻辑查询计划</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#73-%E6%9F%A5%E8%AF%A2%E9%87%8D%E5%86%99"><span class="toc-number">7.3.</span> <span class="toc-text"> 7.3 查询重写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#731-%E8%BD%AC%E6%8D%A2%E8%A7%84%E5%88%99"><span class="toc-number">7.3.1.</span> <span class="toc-text"> 7.3.1 转换规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7311-%E9%80%89%E6%8B%A9%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.3.1.1.</span> <span class="toc-text"> 7.3.1.1 选择转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7312-%E9%80%89%E6%8B%A9%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5-%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.3.1.2.</span> <span class="toc-text"> 7.3.1.2 选择+自然连接 转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7313-%E6%8A%95%E5%BD%B1%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5-%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.3.1.3.</span> <span class="toc-text"> 7.3.1.3 投影+自然连接 转换</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#74-%E6%9F%A5%E8%AF%A2%E8%AE%A1%E5%88%92%E4%BB%A3%E4%BB%B7%E4%BC%B0%E8%AE%A1"><span class="toc-number">7.4.</span> <span class="toc-text"> 7.4 查询计划代价估计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#741-%E4%B8%AD%E9%97%B4%E7%BB%93%E6%9E%9C%E7%9A%84%E5%A4%A7%E5%B0%8F%E4%BC%B0%E8%AE%A1"><span class="toc-number">7.4.1.</span> <span class="toc-text"> 7.4.1 中间结果的大小估计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#742-io-%E4%BB%A3%E4%BB%B7"><span class="toc-number">7.4.2.</span> <span class="toc-text"> 7.4.2 IO 代价</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#743-%E5%BD%B1%E5%93%8D%E6%9F%A5%E8%AF%A2%E8%AE%A1%E5%88%92-io-%E4%BB%A3%E4%BB%B7%E7%9A%84%E5%9B%A0%E7%B4%A0"><span class="toc-number">7.4.3.</span> <span class="toc-text"> 7.4.3 影响查询计划 IO 代价的因素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#744-%E7%89%A9%E7%90%86%E6%93%8D%E4%BD%9C%E7%AC%A6%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92"><span class="toc-number">7.4.4.</span> <span class="toc-text"> 7.4.4 物理操作符之间的参数传递</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#75-%E7%89%A9%E7%90%86%E6%9F%A5%E8%AF%A2%E8%AE%A1%E5%88%92%E9%80%89%E6%8B%A9"><span class="toc-number">7.5.</span> <span class="toc-text"> 7.5 物理查询计划选择</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#76-ms-sql-server-%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">7.6.</span> <span class="toc-text"> 7.6 MS SQL Server 查询优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#761-%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-number">7.6.1.</span> <span class="toc-text"> 7.6.1 执行计划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#762-%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E7%9A%84%E7%BC%93%E5%AD%98%E5%92%8C%E9%87%8D%E7%94%A8"><span class="toc-number">7.6.2.</span> <span class="toc-text"> 7.6.2 执行计划的缓存和重用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#763-%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E7%9A%84%E8%80%81%E5%8C%96"><span class="toc-number">7.6.3.</span> <span class="toc-text"> 7.6.3 执行计划的老化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#764-%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E7%9A%84%E9%87%8D%E7%BC%96%E8%AF%91"><span class="toc-number">7.6.4.</span> <span class="toc-text"> 7.6.4 执行计划的重编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#765-%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E4%BE%8B%E5%AD%90"><span class="toc-number">7.6.5.</span> <span class="toc-text"> 7.6.5 执行计划例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#766-%E5%A4%9A%E9%98%B6%E6%AE%B5%E4%BC%98%E5%8C%96%E5%99%A8"><span class="toc-number">7.6.6.</span> <span class="toc-text"> 7.6.6 多阶段优化器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E8%BF%9E%E6%8E%A5%E7%AE%97%E6%B3%95"><span class="toc-number">8.</span> <span class="toc-text"> 8 连接算法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#81-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">8.1.</span> <span class="toc-text"> 8.1 基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#82-%E7%89%A9%E7%90%86%E6%9F%A5%E8%AF%A2%E8%AE%A1%E5%88%92%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">8.2.</span> <span class="toc-text"> 8.2 物理查询计划操作符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#83-%E8%BF%9E%E6%8E%A5%E6%93%8D%E4%BD%9Cjoin%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%AE%97%E6%B3%95"><span class="toc-number">8.3.</span> <span class="toc-text"> 8.3 连接操作(Join)的实现算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#84-%E8%BF%9E%E6%8E%A5%E7%AE%97%E6%B3%95%E7%9A%84%E4%BB%A3%E4%BB%B7%E5%88%86%E6%9E%90"><span class="toc-number">8.4.</span> <span class="toc-text"> 8.4 连接算法的代价分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-number">9.</span> <span class="toc-text"> 9 事务处理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E7%B3%BB%E7%BB%9F%E6%95%85%E9%9A%9C%E5%AF%B9%E7%AD%96"><span class="toc-number">10.</span> <span class="toc-text"> 10 系统故障对策</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#101-%E6%95%85%E9%9A%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">10.1.</span> <span class="toc-text"> 10.1 故障模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1011-%E4%BA%8B%E5%8A%A1%E6%95%85%E9%9A%9C"><span class="toc-number">10.1.1.</span> <span class="toc-text"> 10.1.1 事务故障</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1012-%E6%95%B0%E6%8D%AE%E9%94%99%E8%AF%AF%E8%BE%93%E5%85%A5"><span class="toc-number">10.1.2.</span> <span class="toc-text"> 10.1.2 数据错误输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1013-%E4%BB%8B%E8%B4%A8%E6%95%85%E9%9A%9C"><span class="toc-number">10.1.3.</span> <span class="toc-text"> 10.1.3 介质故障</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1014-%E7%81%BE%E9%9A%BE%E6%80%A7%E6%95%85%E9%9A%9C"><span class="toc-number">10.1.4.</span> <span class="toc-text"> 10.1.4 灾难性故障</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1015-%E7%B3%BB%E7%BB%9F%E6%95%85%E9%9A%9C"><span class="toc-number">10.1.5.</span> <span class="toc-text"> 10.1.5 系统故障</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#102-%E6%97%A5%E5%BF%97"><span class="toc-number">10.2.</span> <span class="toc-text"> 10.2 日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1021-undo-%E6%97%A5%E5%BF%97"><span class="toc-number">10.2.1.</span> <span class="toc-text"> 10.2.1 undo 日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1022-redo-%E6%97%A5%E5%BF%97"><span class="toc-number">10.2.2.</span> <span class="toc-text"> 10.2.2 redo 日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1023-undoredo-%E6%97%A5%E5%BF%97"><span class="toc-number">10.2.3.</span> <span class="toc-text"> 10.2.3 undo&#x2F;redo 日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1024-%E6%A3%80%E6%9F%A5%E7%82%B9"><span class="toc-number">10.2.4.</span> <span class="toc-text"> 10.2.4 检查点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#103-%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC%E6%8A%80%E6%9C%AF"><span class="toc-number">10.3.</span> <span class="toc-text"> 10.3 日志轮转技术</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#104-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%95%85%E9%9A%9C%E6%81%A2%E5%A4%8D%E7%AD%96%E7%95%A5"><span class="toc-number">10.4.</span> <span class="toc-text"> 10.4 数据库系统故障恢复策略</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">11.</span> <span class="toc-text"> 11 数据库的一致性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#111-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">11.1.</span> <span class="toc-text"> 11.1 基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#112-%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">11.2.</span> <span class="toc-text"> 11.2 事务的状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#113-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%8E%9F%E8%AF%AD%E6%93%8D%E4%BD%9C"><span class="toc-number">11.3.</span> <span class="toc-text"> 11.3 事务的原语操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1131-%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">11.3.1.</span> <span class="toc-text"> 11.3.1 事务的例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1132-sql-%E5%AF%B9%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%94%AF%E6%8C%81"><span class="toc-number">11.3.2.</span> <span class="toc-text"> 11.3.2 SQL 对事务的支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1133-oracle-%E4%B8%AD%E7%9A%84%E4%BA%8B%E5%8A%A1%E8%AE%BE%E7%BD%AE"><span class="toc-number">11.3.3.</span> <span class="toc-text"> 11.3.3 Oracle 中的事务设置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E8%B0%83%E5%BA%A6"><span class="toc-number">12.</span> <span class="toc-text"> 12 并发事务调度</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#121-%E5%86%B2%E7%AA%81%E5%8F%AF%E4%B8%B2%E6%80%A7"><span class="toc-number">12.1.</span> <span class="toc-text"> 12.1 冲突可串性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1211-%E5%86%B2%E7%AA%81%E6%93%8D%E4%BD%9C"><span class="toc-number">12.1.1.</span> <span class="toc-text"> 12.1.1 冲突操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1212-%E5%86%B2%E7%AA%81%E5%8F%AF%E4%B8%B2"><span class="toc-number">12.1.2.</span> <span class="toc-text"> 12.1.2 冲突可串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1213-%E4%BC%98%E5%85%88%E5%9B%BE"><span class="toc-number">12.1.3.</span> <span class="toc-text"> 12.1.3 优先图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-nosql-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">13.</span> <span class="toc-text"> 13 NoSQL 数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#131-nosql-%E5%85%B4%E8%B5%B7%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">13.1.</span> <span class="toc-text"> 13.1 NoSQL 兴起的原因</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#132-cap"><span class="toc-number">13.2.</span> <span class="toc-text"> 13.2 CAP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#133-base"><span class="toc-number">13.3.</span> <span class="toc-text"> 13.3 BASE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#134-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">13.4.</span> <span class="toc-text"> 13.4 存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1341-lsm-tree-%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-number">13.4.1.</span> <span class="toc-text"> 13.4.1 LSM-tree 的设计思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1342-lsm-tree-%E7%9A%84%E6%80%BB%E7%BB%93"><span class="toc-number">13.4.2.</span> <span class="toc-text"> 13.4.2 LSM-tree 的总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1343-%E4%BC%98%E5%8C%96%E5%B7%A5%E4%BD%9C"><span class="toc-number">13.4.3.</span> <span class="toc-text"> 13.4.3 优化工作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#135-hbase-%E5%92%8C-hdfs-%E5%92%8C-zookeeper"><span class="toc-number">13.5.</span> <span class="toc-text"> 13.5 HBase 和 HDFS 和 Zookeeper</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1351-hbase-%E7%AE%80%E4%BB%8B"><span class="toc-number">13.5.1.</span> <span class="toc-text"> 13.5.1 HBase 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1352-hbase-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">13.5.2.</span> <span class="toc-text"> 13.5.2 HBase 数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1353-table-%E7%9A%84%E7%89%A9%E7%90%86%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">13.5.3.</span> <span class="toc-text"> 13.5.3 Table 的物理存储结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1354-%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%86%99%E8%BF%87%E7%A8%8B"><span class="toc-number">13.5.4.</span> <span class="toc-text"> 13.5.4 数据读写过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1355-hbase-%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">13.5.5.</span> <span class="toc-text"> 13.5.5 HBase 访问接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#136-mongodb"><span class="toc-number">13.6.</span> <span class="toc-text"> 13.6 MongoDB</span></a></li></ol></li></ol></div></div><div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden;"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%;"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84prompt%E5%A4%A7%E5%B9%85%E6%8F%90%E5%8D%87chatgpt%E7%BF%BB%E8%AF%91%E8%B4%A8%E9%87%8F%EF%BC%8C%E5%91%8A%E5%88%AB%E2%80%9C%E6%9C%BA%E7%BF%BB%E6%84%9F%E2%80%9D" title="一个简单的Prompt大幅提升ChatGPT翻译质量，告别“机翻感”"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/202310071617236.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="一个简单的Prompt大幅提升ChatGPT翻译质量，告别“机翻感”"/></a><div class="content"><a class="title" href="/posts/%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84prompt%E5%A4%A7%E5%B9%85%E6%8F%90%E5%8D%87chatgpt%E7%BF%BB%E8%AF%91%E8%B4%A8%E9%87%8F%EF%BC%8C%E5%91%8A%E5%88%AB%E2%80%9C%E6%9C%BA%E7%BF%BB%E6%84%9F%E2%80%9D" title="一个简单的Prompt大幅提升ChatGPT翻译质量，告别“机翻感”">一个简单的Prompt大幅提升ChatGPT翻译质量，告别“机翻感”</a><time datetime="2023-10-07T08:21:30.000Z" title="发表于 2023-10-07 16:21:30">2023-10-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/%E5%8D%9A%E5%AE%A2/vscode%E8%BF%9E%E6%8E%A5%E4%B8%8D%E7%94%A8%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81" title="vscode连接不用输入密码"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121647509.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vscode连接不用输入密码"/></a><div class="content"><a class="title" href="/posts/%E5%8D%9A%E5%AE%A2/vscode%E8%BF%9E%E6%8E%A5%E4%B8%8D%E7%94%A8%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81" title="vscode连接不用输入密码">vscode连接不用输入密码</a><time datetime="2023-05-07T13:40:20.000Z" title="发表于 2023-05-07 21:40:20">2023-05-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/%E5%8D%9A%E5%AE%A2/%E6%88%BF%E5%9C%B0%E4%BA%A7%E6%B5%85%E8%B0%881" title="房地产浅谈1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121700465.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="房地产浅谈1"/></a><div class="content"><a class="title" href="/posts/%E5%8D%9A%E5%AE%A2/%E6%88%BF%E5%9C%B0%E4%BA%A7%E6%B5%85%E8%B0%881" title="房地产浅谈1">房地产浅谈1</a><time datetime="2023-03-18T17:10:37.000Z" title="发表于 2023-03-19 01:10:37">2023-03-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/%E5%8D%9A%E5%AE%A2/hexo%E7%9A%84%E5%A4%9A%E7%A7%8Dmarkdown%E6%B8%B2%E6%9F%93%E5%99%A8%E5%AF%B9%E6%AF%94%E5%88%86%E6%9E%90" title="Hexo的多种Markdown渲染器对比分析"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121702403.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hexo的多种Markdown渲染器对比分析"/></a><div class="content"><a class="title" href="/posts/%E5%8D%9A%E5%AE%A2/hexo%E7%9A%84%E5%A4%9A%E7%A7%8Dmarkdown%E6%B8%B2%E6%9F%93%E5%99%A8%E5%AF%B9%E6%AF%94%E5%88%86%E6%9E%90" title="Hexo的多种Markdown渲染器对比分析">Hexo的多种Markdown渲染器对比分析</a><time datetime="2023-03-18T16:48:10.000Z" title="发表于 2023-03-19 00:48:10">2023-03-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/hexo-obsidian-%E5%86%85%E9%83%A8%E9%93%BE%E6%8E%A5%E8%B7%B3%E8%BD%AC" title="Hexo+Obsidian 内部链接跳转"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/RongkangXiong/pic-bed/blog/img/front-cover-202112121646653.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hexo+Obsidian 内部链接跳转"/></a><div class="content"><a class="title" href="/posts/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/hexo-obsidian-%E5%86%85%E9%83%A8%E9%93%BE%E6%8E%A5%E8%B7%B3%E8%BD%AC" title="Hexo+Obsidian 内部链接跳转">Hexo+Obsidian 内部链接跳转</a><time datetime="2023-03-18T15:21:29.000Z" title="发表于 2023-03-18 23:21:29">2023-03-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/images/website/background-1.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Rongkang Xiong</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script><script src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script> var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?a6063fa59adbd2b2dc2df06e49673c5a";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm, s);})();</script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>